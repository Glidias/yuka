/*

 The MIT License

 Copyright  2019 Yuka authors

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(d){var k=0;return function(){return k<d.length?{done:!1,value:d[k++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.makeIterator=function(d){var k="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];return k?k.call(d):$jscomp.arrayIterator(d)};$jscomp.arrayFromIterator=function(d){for(var k,g=[];!(k=d.next()).done;)g.push(k.value);return g};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(d){var k=function(){};k.prototype=d;return new k};$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},k={};try{return k.__proto__=d,k.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,k){d.__proto__=k;if(d.__proto__!==k)throw new TypeError(d+" is not extensible");return d}:null;
$jscomp.inherits=function(d,k){d.prototype=$jscomp.objectCreate(k.prototype);d.prototype.constructor=d;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(d,k)}else for(g in k)if("prototype"!=g)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(k,g);r&&Object.defineProperty(d,g,r)}else d[g]=k[g];d.superClass_=k.prototype};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,k,g){d!=Array.prototype&&d!=Object.prototype&&(d[k]=g.value)};$jscomp.polyfill=function(d,k,g,r){if(k){g=$jscomp.global;d=d.split(".");for(r=0;r<d.length-1;r++){var q=d[r];q in g||(g[q]={});g=g[q]}d=d[d.length-1];r=g[d];k=k(r);k!=r&&null!=k&&$jscomp.defineProperty(g,d,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Number.EPSILON",function(d){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Math.sign",function(d){return d?d:function(d){d=Number(d);return 0===d||isNaN(d)?d:0<d?1:-1}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},k=Object.create(new $jscomp.global.Proxy(d,{get:function(g,r,q){return g==d&&"q"==r&&q==k}}));return!0===k.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(d,k){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:k})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function d(g){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(g||"")+"_"+k++,g)}var k=0;return d}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.asyncIterator;d||(d=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.owns=function(d,k){return Object.prototype.hasOwnProperty.call(d,k)};
$jscomp.polyfill("WeakMap",function(d){function k(){if(!d||!Object.seal)return!1;try{var F=Object.seal({}),k=Object.seal({}),g=new d([[F,2],[k,3]]);if(2!=g.get(F)||3!=g.get(k))return!1;g.delete(F);g.set(k,4);return!g.has(F)&&4==g.get(k)}catch(td){return!1}}function g(){}function r(d){if(!$jscomp.owns(d,t)){var F=new g;$jscomp.defineProperty(d,t,{value:F})}}function q(d){var F=Object[d];F&&(Object[d]=function(d){if(d instanceof g)return d;r(d);return F(d)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&
$jscomp.ES6_CONFORMANCE)return d}else if(k())return d;var t="$jscomp_hidden_"+Math.random();q("freeze");q("preventExtensions");q("seal");var m=0,xa=function(d){this.id_=(m+=Math.random()+1).toString();if(d){d=$jscomp.makeIterator(d);for(var F;!(F=d.next()).done;)F=F.value,this.set(F[0],F[1])}};xa.prototype.set=function(d,g){r(d);if(!$jscomp.owns(d,t))throw Error("WeakMap key fail: "+d);d[t][this.id_]=g;return this};xa.prototype.get=function(d){return $jscomp.owns(d,t)?d[t][this.id_]:void 0};xa.prototype.has=
function(d){return $jscomp.owns(d,t)&&$jscomp.owns(d[t],this.id_)};xa.prototype.delete=function(d){return $jscomp.owns(d,t)&&$jscomp.owns(d[t],this.id_)?delete d[t][this.id_]:!1};return xa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function k(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var F=Object.seal({x:4}),g=new d($jscomp.makeIterator([[F,"s"]]));if("s"!=g.get(F)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var k=g.entries(),m=k.next();if(m.done||m.value[0]!=F||"s"!=m.value[1])return!1;m=k.next();return m.done||4!=m.value[0].x||"t"!=m.value[1]||!k.next().done?!1:!0}catch(Ra){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(k())return d;$jscomp.initSymbolIterator();var g=new WeakMap,r=function(d){this.data_={};this.head_=m();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var g;!(g=d.next()).done;)g=g.value,this.set(g[0],g[1])}};r.prototype.set=function(d,g){d=0===d?0:d;var k=q(this,d);k.list||(k.list=this.data_[k.id]=[]);k.entry?k.entry.value=g:(k.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,
value:g},k.list.push(k.entry),this.head_.previous.next=k.entry,this.head_.previous=k.entry,this.size++);return this};r.prototype.delete=function(d){d=q(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};r.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=m();this.size=0};r.prototype.has=function(d){return!!q(this,d).entry};
r.prototype.get=function(d){return(d=q(this,d).entry)&&d.value};r.prototype.entries=function(){return t(this,function(d){return[d.key,d.value]})};r.prototype.keys=function(){return t(this,function(d){return d.key})};r.prototype.values=function(){return t(this,function(d){return d.value})};r.prototype.forEach=function(d,g){for(var k=this.entries(),m;!(m=k.next()).done;)m=m.value,d.call(g,m[1],m[0],this)};r.prototype[Symbol.iterator]=r.prototype.entries;var q=function(d,k){var m=k&&typeof k;"object"==
m||"function"==m?g.has(k)?m=g.get(k):(m=""+ ++xa,g.set(k,m)):m="p_"+k;var r=d.data_[m];if(r&&$jscomp.owns(d.data_,m))for(d=0;d<r.length;d++){var q=r[d];if(k!==k&&q.key!==q.key||k===q.key)return{id:m,list:r,index:d,entry:q}}return{id:m,list:r,index:-1,entry:void 0}},t=function(d,k){var g=d.head_;return $jscomp.iteratorPrototype(function(){if(g){for(;g.head!=d.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:k(g)};g=null}return{done:!0,value:void 0}})},m=function(){var d={};return d.previous=
d.next=d.head=d},xa=0;return r},"es6","es3");$jscomp.iteratorFromArray=function(d,k){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var g=0,r={next:function(){if(g<d.length){var q=g++;return{value:k(q,d[q]),done:!1}}r.next=function(){return{done:!0,value:void 0}};return r.next()}};r[Symbol.iterator]=function(){return r};return r};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,g){return g})}},"es8","es3");
$jscomp.polyfill("Array.from",function(d){return d?d:function(d,g,r){g=null!=g?g:function(d){return d};var k=[],t="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];if("function"==typeof t){d=t.call(d);for(var m=0;!(t=d.next()).done;)k.push(g.call(r,t.value,m++))}else for(t=d.length,m=0;m<t;m++)k.push(g.call(r,d[m],m));return k}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,g){return[d,g]})}},"es6","es3");
$jscomp.polyfill("Set",function(d){function k(){if($jscomp.ASSUME_NO_NATIVE_SET||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),k=new d($jscomp.makeIterator([g]));if(!k.has(g)||1!=k.size||k.add(g)!=k||1!=k.size||k.add({x:4})!=k||2!=k.size)return!1;var t=k.entries(),m=t.next();if(m.done||m.value[0]!=g||m.value[1]!=g)return!1;m=t.next();return m.done||m.value[0]==g||4!=m.value[0].x||m.value[1]!=m.value[0]?!1:t.next().done}catch(xa){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(k())return d;$jscomp.initSymbolIterator();var g=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var g;!(g=d.next()).done;)this.add(g.value)}this.size=this.map_.size};g.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};g.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};g.prototype.clear=function(){this.map_.clear();
this.size=0};g.prototype.has=function(d){return this.map_.has(d)};g.prototype.entries=function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(d,g){var k=this;this.map_.forEach(function(m){return d.call(g,m,m,k)})};return g},"es6","es3");
$jscomp.polyfill("Object.is",function(d){return d?d:function(d,g){return d===g?0!==d||1/d===1/g:d!==d&&g!==g}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(d){return d?d:function(d,g){var k=this;k instanceof String&&(k=String(k));var q=k.length;g=g||0;for(0>g&&(g=Math.max(g+q,0));g<q;g++){var t=k[g];if(t===d||Object.is(t,d))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(d,k,g){if(null==d)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return d+""};$jscomp.polyfill("String.prototype.includes",function(d){return d?d:function(d,g){return-1!==$jscomp.checkStringArgs(this,d,"includes").indexOf(d,g||0)}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function k(){this.batch_=null}function g(d){return d instanceof q?d:new q(function(g,k){g(d)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;k.prototype.asyncExecute=function(d){if(null==this.batch_){this.batch_=[];var g=this;this.asyncExecuteFunction(function(){g.executeBatch_()})}this.batch_.push(d)};var r=$jscomp.global.setTimeout;k.prototype.asyncExecuteFunction=function(d){r(d,0)};k.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=
this.batch_;this.batch_=[];for(var g=0;g<d.length;++g){var k=d[g];d[g]=null;try{k()}catch(Db){this.asyncThrow_(Db)}}}this.batch_=null};k.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var q=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var g=this.createResolveAndReject_();try{d(g.resolve,g.reject)}catch(F){g.reject(F)}};q.prototype.createResolveAndReject_=function(){function d(d){return function(m){k||(k=!0,d.call(g,m))}}var g=this,k=
!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};q.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof q)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var g=null!=d;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};q.prototype.resolveToNonPromiseObj_=function(d){var g=void 0;try{g=d.then}catch(F){this.reject_(F);return}"function"==typeof g?
this.settleSameAsThenable_(g,d):this.fulfill_(d)};q.prototype.reject_=function(d){this.settle_(2,d)};q.prototype.fulfill_=function(d){this.settle_(1,d)};q.prototype.settle_=function(d,g){if(0!=this.state_)throw Error("Cannot settle("+d+", "+g+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=g;this.executeOnSettledCallbacks_()};q.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=0;d<this.onSettledCallbacks_.length;++d)t.asyncExecute(this.onSettledCallbacks_[d]);
this.onSettledCallbacks_=null}};var t=new k;q.prototype.settleSameAsPromise_=function(d){var g=this.createResolveAndReject_();d.callWhenSettled_(g.resolve,g.reject)};q.prototype.settleSameAsThenable_=function(d,g){var k=this.createResolveAndReject_();try{d.call(g,k.resolve,k.reject)}catch(Db){k.reject(Db)}};q.prototype.then=function(d,g){function k(d,g){return"function"==typeof d?function(g){try{m(d(g))}catch(ta){r(ta)}}:g}var m,r,t=new q(function(d,g){m=d;r=g});this.callWhenSettled_(k(d,m),k(g,r));
return t};q.prototype.catch=function(d){return this.then(void 0,d)};q.prototype.callWhenSettled_=function(d,g){function k(){switch(m.state_){case 1:d(m.result_);break;case 2:g(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?t.asyncExecute(k):this.onSettledCallbacks_.push(k)};q.resolve=g;q.reject=function(d){return new q(function(g,k){k(d)})};q.race=function(d){return new q(function(k,m){for(var r=$jscomp.makeIterator(d),q=r.next();!q.done;q=
r.next())g(q.value).callWhenSettled_(k,m)})};q.all=function(d){var k=$jscomp.makeIterator(d),m=k.next();return m.done?g([]):new q(function(d,q){function r(g){return function(k){t[g]=k;y--;0==y&&d(t)}}var t=[],y=0;do t.push(void 0),y++,g(m.value).callWhenSettled_(r(t.length-1),q),m=k.next();while(!m.done)})};return q},"es6","es3");
(function(d,k){"object"===typeof exports&&"undefined"!==typeof module?k(exports):"function"===typeof define&&define.amd?define(["exports"],k):(d=d||self,k(d.YUKA={}))})(this,function(d){function k(a){for(var b=[],c=0,e=a.length;c<e;c++)b.push(a[c].uuid);return b}function g(){!0===this.detectPageVisibility&&!1===document.hidden&&(this.currentTime=this.now())}function r(a,b,c){return 1/Math.sqrt(2*Math.PI*c)*Math.exp(-Math.pow(a-b,2)/(2*c))}function q(a,b){return a<b?-1:a>b?1:0}function t(a,b){return a.cost<
b.cost?-1:a.cost>b.cost?1:0}function m(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function xa(a,b){return a.p-b.p}function F(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function Db(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function sd(a,b){var c=a.edge,e=Infinity;do{Bc.set(c.prev.vertex,c.vertex);var h=Bc.closestPointToPointParameter(b);Bc.at(h,Cc);h=Cc.squaredDistanceTo(b);h<e&&(e=h,ud.copy(Cc));c=c.next}while(c!==
a.edge);return ud}function td(a){for(var b=this.tasks;0<a.timeRemaining()&&0<b.length;)b[0].execute(),b.shift();0<b.length?(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):(this._taskHandle=0,this._active=!1)}var Ra=function(a,b,c,e,h){this.sender=a;this.receiver=b;this.message=c;this.delay=e;this.data=h};Ra.prototype.toJSON=function(){return{type:this.constructor.name,sender:this.sender?this.sender.uuid:null,receiver:this.receiver?this.receiver.uuid:null,message:this.message,
delay:this.delay,data:this.data}};Ra.prototype.fromJSON=function(a){this.sender=a.sender;this.receiver=a.receiver;this.message=a.message;this.delay=a.delay;this.data=a.data;return this};Ra.prototype.resolveReferences=function(a){this.sender=a.get(this.sender);this.receiver=a.get(this.receiver);return this};var y=function(){};y.setLevel=function(a){Xb=a};y.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Xb<=y.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};
y.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Xb<=y.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};y.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Xb<=y.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};y.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var Xb=y.LEVEL.WARN,ta=function(){this.delayedTelegrams=[]};ta.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&
y.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b);return this};ta.prototype.dispatch=function(a,b,c,e,h){a=new Ra(a,b,c,e,h);0>=e?this.deliver(a):this.delayedTelegrams.push(a);return this};ta.prototype.dispatchDelayedMessages=function(a){for(var b=this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}return this};ta.prototype.clear=function(){this.delayedTelegrams.length=0;return this};ta.prototype.toJSON=
function(){for(var a={type:this.constructor.name,delayedTelegrams:[]},b=0,c=this.delayedTelegrams.length;b<c;b++)a.delayedTelegrams.push(this.delayedTelegrams[b].toJSON());return a};ta.prototype.fromJSON=function(a){this.clear();a=a.delayedTelegrams;for(var b=0,c=a.length;b<c;b++){var e=a[b];e=(new Ra).fromJSON(e);this.delayedTelegrams.push(e)}return this};ta.prototype.resolveReferences=function(a){for(var b=this.delayedTelegrams,c=0,e=b.length;c<e;c++)b[c].resolveReferences(a);return this};for(var Y=
[],Eb=0;256>Eb;Eb++)Y[Eb]=(16>Eb?"0":"")+Eb.toString(16);var M=function(){};M.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};M.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};M.randFloat=function(a,b){return a+Math.random()*(b-a)};M.area=function(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};M.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(Y[a&255]+Y[a>>8&255]+
Y[a>>16&255]+Y[a>>24&255]+"-"+Y[b&255]+Y[b>>8&255]+"-"+Y[b>>16&15|64]+Y[b>>24&255]+"-"+Y[c&63|128]+Y[c>>8&255]+"-"+Y[c>>16&255]+Y[c>>24&255]+Y[e&255]+Y[e>>8&255]+Y[e>>16&255]+Y[e>>24&255]).toUpperCase()};var f=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};f.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};f.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};f.prototype.clone=function(){return(new this.constructor).copy(this)};
f.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};f.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};f.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};f.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};f.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};f.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};f.prototype.multiply=
function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};f.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};f.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};f.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};f.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};f.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};
f.prototype.reflect=function(a){return this.sub(xe.copy(a).multiplyScalar(2*this.dot(a)))};f.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};f.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};f.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};
f.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};f.prototype.cross=function(a){var b=this.x,c=this.y,e=this.z;this.x=c*a.z-e*a.y;this.y=e*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};f.prototype.crossVectors=function(a,b){var c=a.x,e=a.y;a=a.z;var h=b.x,n=b.y;b=b.z;this.x=e*b-a*n;this.y=a*h-c*b;this.z=c*n-e*h;return this};f.prototype.angleTo=function(a){var b=Math.sqrt(this.squaredLength()*a.squaredLength());if(0===b)return 0;a=this.dot(a)/b;return Math.acos(M.clamp(a,-1,1))};f.prototype.length=
function(){return Math.sqrt(this.squaredLength())};f.prototype.squaredLength=function(){return this.dot(this)};f.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};f.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};f.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};f.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-
a.z)};f.prototype.normalize=function(){return this.divideScalar(this.length()||1)};f.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;var h=1/(a[3]*b+a[7]*c+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*e+a[12])*h;this.y=(a[1]*b+a[5]*c+a[9]*e+a[13])*h;this.z=(a[2]*b+a[6]*c+a[10]*e+a[14])*h;return this};f.prototype.applyRotation=function(a){var b=this.x,c=this.y,e=this.z,h=a.x,n=a.y,d=a.z;a=a.w;var l=a*b+n*e-d*c,f=a*c+d*b-h*e,Dc=a*e+h*c-n*b;b=-h*b-n*c-d*e;this.x=l*a+b*-h+
f*-d-Dc*-n;this.y=f*a+b*-n+Dc*-h-l*-d;this.z=Dc*a+b*-d+l*-n-f*-h;return this};f.prototype.extractPositionFromMatrix=function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this};f.prototype.transformDirection=function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e;this.y=a[1]*b+a[5]*c+a[9]*e;this.z=a[2]*b+a[6]*c+a[10]*e;return this.normalize()};f.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};f.prototype.fromMatrix4Column=
function(a,b){return this.fromArray(a.elements,4*b)};f.prototype.fromSpherical=function(a,b,c){var e=Math.sin(b)*a;this.x=e*Math.sin(c);this.y=Math.cos(b)*a;this.z=e*Math.cos(c);return this};f.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};f.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};f.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var xe=new f,Ec=new f(0,
1,0),vd=new f,Fb=new f,wd=new f,xd=new f,Fc=[2,2,1],Gc=[1,0,0],C=function(){this.elements=[1,0,0,0,1,0,0,0,1]};C.prototype.set=function(a,b,c,e,h,n,d,l,f){var z=this.elements;z[0]=a;z[3]=b;z[6]=c;z[1]=e;z[4]=h;z[7]=n;z[2]=d;z[5]=l;z[8]=f;return this};C.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};C.prototype.clone=function(){return(new this.constructor).copy(this)};C.prototype.identity=
function(){this.set(1,0,0,0,1,0,0,0,1);return this};C.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};C.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};C.prototype.multiplyMatrices=function(a,b){var c=a.elements,e=b.elements;b=this.elements;a=c[0];var h=c[3],n=c[6],d=c[1],l=c[4],f=c[7],g=c[2],k=c[5];c=c[8];var m=e[0],p=e[3],q=e[6],r=e[1],Hc=e[4],Ic=e[7],u=e[2],t=e[5];e=e[8];b[0]=a*m+h*r+n*u;b[3]=a*p+h*Hc+n*t;b[6]=a*q+h*Ic+n*e;b[1]=d*m+l*r+f*u;b[4]=d*p+
l*Hc+f*t;b[7]=d*q+l*Ic+f*e;b[2]=g*m+k*r+c*u;b[5]=g*p+k*Hc+c*t;b[8]=g*q+k*Ic+c*e;return this};C.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};C.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};C.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};C.prototype.lookAt=function(a,
b,c){vd.crossVectors(c,a).normalize();Fb.crossVectors(Ec,b).normalize();0===Fb.squaredLength()&&(xd.copy(b).addScalar(Number.EPSILON),Fb.crossVectors(Ec,xd).normalize());wd.crossVectors(b,Fb).normalize();gb.makeBasis(Fb,wd,b);Yb.makeBasis(vd,c,a);this.multiplyMatrices(gb,Yb.transpose());return this};C.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};C.prototype.getElementIndex=function(a,b){return 3*a+b};C.prototype.frobeniusNorm=
function(){for(var a=this.elements,b=0,c=0;9>c;c++)b+=a[c]*a[c];return Math.sqrt(b)};C.prototype.offDiagonalFrobeniusNorm=function(){for(var a=this.elements,b=0,c=0;3>c;c++){var e=a[this.getElementIndex(Fc[c],Gc[c])];b+=2*e*e}return Math.sqrt(b)};C.prototype.eigenDecomposition=function(a){var b=0,c=0;a.unitary.identity();a.diagonal.copy(this);for(var e=a.unitary,h=a.diagonal,n=Number.EPSILON*h.frobeniusNorm();10>c&&h.offDiagonalFrobeniusNorm()>n;)h.shurDecomposition(gb),Yb.copy(gb).transpose(),h.multiply(gb),
h.premultiply(Yb),e.multiply(gb),2<++b&&(c++,b=0);return a};C.prototype.shurDecomposition=function(a){for(var b=0,c=1,e=this.elements,h=0;3>h;h++){var n=Math.abs(e[this.getElementIndex(Fc[h],Gc[h])]);n>b&&(b=n,c=h)}h=1;n=0;b=Gc[c];c=Fc[c];Math.abs(e[this.getElementIndex(c,b)])>Number.EPSILON&&(h=e[this.getElementIndex(c,c)],n=e[this.getElementIndex(b,b)],e=e[this.getElementIndex(c,b)],e=(h-n)/2/e,e=0>e?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),h=1/Math.sqrt(1+e*e),n=e*h);a.identity();a.elements[this.getElementIndex(b,
b)]=h;a.elements[this.getElementIndex(c,c)]=h;a.elements[this.getElementIndex(c,b)]=n;a.elements[this.getElementIndex(b,c)]=-n;return a};C.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,e=a.y,h=a.z,n=a.w,d=c+c,l=e+e,f=h+h;a=c*d;var g=c*l;c*=f;var k=e*l;e*=f;h*=f;d*=n;l*=n;n*=f;b[0]=1-(k+h);b[3]=g-n;b[6]=c+l;b[1]=g+n;b[4]=1-(a+h);b[7]=e-d;b[2]=c-l;b[5]=e+d;b[8]=1-(a+k);return this};C.prototype.fromMatrix4=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=
a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return this};C.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,e=0;9>e;e++)c[e]=a[e+b];return this};C.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};C.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var gb=new C,
Yb=new C,Zb=new C,Jc=new f,w=function(a,b,c,e){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===e?1:e};w.prototype.set=function(a,b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this};w.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};w.prototype.clone=function(){return(new this.constructor).copy(this)};w.prototype.inverse=function(){return this.conjugate().normalize()};w.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=
-1;return this};w.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};w.prototype.length=function(){return Math.sqrt(this.squaredLength())};w.prototype.squaredLength=function(){return this.dot(this)};w.prototype.normalize=function(){var a=this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};w.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};w.prototype.premultiply=function(a){return this.multiplyQuaternions(a,
this)};w.prototype.multiplyQuaternions=function(a,b){var c=a.x,e=a.y,h=a.z;a=a.w;var n=b.x,d=b.y,l=b.z;b=b.w;this.x=c*b+a*n+e*l-h*d;this.y=e*b+a*d+h*n-c*l;this.z=h*b+a*l+c*d-e*n;this.w=a*b-c*n-e*d-h*l;return this};w.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(M.clamp(this.dot(a),-1,1)))};w.prototype.rotateTo=function(a,b,c){c=void 0===c?.0001:c;var e=this.angleTo(a);if(e<c)return!0;this.slerp(a,Math.min(1,b/e));return!1};w.prototype.lookAt=function(a,b,c){Zb.lookAt(a,b,c);this.fromMatrix3(Zb)};
w.prototype.slerp=function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this.x,e=this.y,h=this.z,n=this.w,d=n*a.w+c*a.x+e*a.y+h*a.z;0>d?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,d=-d):this.copy(a);if(1<=d)return this.w=n,this.x=c,this.y=e,this.z=h,this;a=Math.sqrt(1-d*d);if(.001>Math.abs(a))return this.w=.5*(n+this.w),this.x=.5*(c+this.x),this.y=.5*(e+this.y),this.z=.5*(h+this.z),this;var l=Math.atan2(a,d);d=Math.sin((1-b)*l)/a;b=Math.sin(b*l)/a;this.w=n*d+this.w*b;this.x=c*
d+this.x*b;this.y=e*d+this.y*b;this.z=h*d+this.z*b;return this};w.prototype.extractRotationFromMatrix=function(a){var b=Zb.elements,c=a.elements,e=1/Jc.fromMatrix4Column(a,0).length(),h=1/Jc.fromMatrix4Column(a,1).length();a=1/Jc.fromMatrix4Column(a,2).length();b[0]=c[0]*e;b[1]=c[1]*e;b[2]=c[2]*e;b[3]=c[4]*h;b[4]=c[5]*h;b[5]=c[6]*h;b[6]=c[8]*a;b[7]=c[9]*a;b[8]=c[10]*a;this.fromMatrix3(Zb);return this};w.prototype.fromEuler=function(a,b,c){var e=Math.cos(b/2),h=Math.cos(a/2),n=Math.cos(c/2);b=Math.sin(b/
2);a=Math.sin(a/2);c=Math.sin(c/2);this.w=e*h*n+b*a*c;this.x=e*a*n+b*h*c;this.y=b*h*n-e*a*c;this.z=e*h*c-b*a*n;return this};w.prototype.toEuler=function(a){var b=-2*(this.y*this.z-this.x*this.w);.9999<Math.abs(b)?(a.x=.5*Math.PI*b,a.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),a.z=0):(a.x=Math.asin(b),a.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),a.z=Math.atan2(this.x*this.y+this.w*this.z,.5-this.x*this.x-this.z*this.z));return a};w.prototype.fromMatrix3=
function(a){var b=a.elements,c=b[0];a=b[3];var e=b[6],h=b[1],n=b[4],d=b[7],l=b[2],f=b[5];b=b[8];var g=c+n+b;0<g?(c=.5/Math.sqrt(g+1),this.w=.25/c,this.x=(f-d)*c,this.y=(e-l)*c,this.z=(h-a)*c):c>n&&c>b?(c=2*Math.sqrt(1+c-n-b),this.w=(f-d)/c,this.x=.25*c,this.y=(a+h)/c,this.z=(e+l)/c):n>b?(c=2*Math.sqrt(1+n-c-b),this.w=(e-l)/c,this.x=(a+h)/c,this.y=.25*c,this.z=(d+f)/c):(c=2*Math.sqrt(1+b-c-n),this.w=(h-a)/c,this.x=(e+l)/c,this.y=(d+f)/c,this.z=.25*c);return this};w.prototype.fromArray=function(a,b){b=
void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};w.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};w.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w};var D=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};D.prototype.set=function(a,b,c,e,h,n,d,l,f,g,k,m,p,q,r,u){var z=this.elements;z[0]=a;z[4]=b;z[8]=c;z[12]=e;z[1]=h;z[5]=n;z[9]=d;z[13]=l;z[2]=
f;z[6]=g;z[10]=k;z[14]=m;z[3]=p;z[7]=q;z[11]=r;z[15]=u;return this};D.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};D.prototype.clone=function(){return(new this.constructor).copy(this)};D.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};D.prototype.multiply=function(a){return this.multiplyMatrices(this,
a)};D.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};D.prototype.multiplyMatrices=function(a,b){var c=a.elements,e=b.elements;b=this.elements;a=c[0];var h=c[4],n=c[8],d=c[12],l=c[1],f=c[5],g=c[9],k=c[13],m=c[2],p=c[6],q=c[10],r=c[14],u=c[3],t=c[7],v=c[11];c=c[15];var x=e[0],y=e[4],A=e[8],B=e[12],C=e[1],w=e[5],D=e[9],E=e[13],F=e[2],G=e[6],H=e[10],I=e[14],J=e[3],K=e[7],L=e[11];e=e[15];b[0]=a*x+h*C+n*F+d*J;b[4]=a*y+h*w+n*G+d*K;b[8]=a*A+h*D+n*H+d*L;b[12]=a*B+h*E+n*I+d*e;b[1]=
l*x+f*C+g*F+k*J;b[5]=l*y+f*w+g*G+k*K;b[9]=l*A+f*D+g*H+k*L;b[13]=l*B+f*E+g*I+k*e;b[2]=m*x+p*C+q*F+r*J;b[6]=m*y+p*w+q*G+r*K;b[10]=m*A+p*D+q*H+r*L;b[14]=m*B+p*E+q*I+r*e;b[3]=u*x+t*C+v*F+c*J;b[7]=u*y+t*w+v*G+c*K;b[11]=u*A+t*D+v*H+c*L;b[15]=u*B+t*E+v*I+c*e;return this};D.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};D.prototype.extractBasis=function(a,
b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};D.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};D.prototype.compose=function(a,b,c){this.fromQuaternion(b);this.scale(c);this.setPosition(a);return this};D.prototype.scale=function(a){var b=this.elements,c=a.x,e=a.y;a=a.z;b[0]*=c;b[4]*=e;b[8]*=a;b[1]*=c;b[5]*=e;b[9]*=a;b[2]*=c;b[6]*=e;b[10]*=a;b[3]*=c;b[7]*=e;b[11]*=a;return this};D.prototype.setPosition=
function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};D.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};D.prototype.getInverse=function(a){var b=this.elements,c=a.elements,e=b[0],h=b[1],n=b[2],d=b[3],l=b[4],f=b[5],g=b[6],k=b[7],m=b[8],p=b[9],q=b[10],r=b[11],u=b[12],t=b[13],v=b[14];b=b[15];var x=p*v*k-t*q*k+
t*g*r-f*v*r-p*g*b+f*q*b,A=u*q*k-m*v*k-u*g*r+l*v*r+m*g*b-l*q*b,B=m*t*k-u*p*k+u*f*r-l*t*r-m*f*b+l*p*b,C=u*p*g-m*t*g-u*f*q+l*t*q+m*f*v-l*p*v,w=e*x+h*A+n*B+d*C;if(0===w)return y.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),this.identity();w=1/w;c[0]=x*w;c[1]=(t*q*d-p*v*d-t*n*r+h*v*r+p*n*b-h*q*b)*w;c[2]=(f*v*d-t*g*d+t*n*k-h*v*k-f*n*b+h*g*b)*w;c[3]=(p*g*d-f*q*d-p*n*k+h*q*k+f*n*r-h*g*r)*w;c[4]=A*w;c[5]=(m*v*d-u*q*d+u*n*r-e*v*r-m*n*b+e*q*b)*w;c[6]=(u*g*d-l*v*d-u*n*k+e*v*k+
l*n*b-e*g*b)*w;c[7]=(l*q*d-m*g*d+m*n*k-e*q*k-l*n*r+e*g*r)*w;c[8]=B*w;c[9]=(u*p*d-m*t*d-u*h*r+e*t*r+m*h*b-e*p*b)*w;c[10]=(l*t*d-u*f*d+u*h*k-e*t*k-l*h*b+e*f*b)*w;c[11]=(m*f*d-l*p*d-m*h*k+e*p*k+l*h*r-e*f*r)*w;c[12]=C*w;c[13]=(m*t*n-u*p*n+u*h*q-e*t*q-m*h*v+e*p*v)*w;c[14]=(u*f*n-l*t*n-u*h*g+e*t*g+l*h*v-e*f*v)*w;c[15]=(l*p*n-m*f*n+m*h*g-e*p*g-l*h*q+e*f*q)*w;return a};D.prototype.getMaxScale=function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],
a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))};D.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,e=a.y,h=a.z,n=a.w,d=c+c,l=e+e,f=h+h;a=c*d;var g=c*l;c*=f;var k=e*l;e*=f;h*=f;d*=n;l*=n;n*=f;b[0]=1-(k+h);b[4]=g-n;b[8]=c+l;b[1]=g+n;b[5]=1-(a+h);b[9]=e-d;b[2]=c-l;b[6]=e+d;b[10]=1-(a+k);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};D.prototype.fromMatrix3=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=0;b[4]=a[3];b[5]=a[4];b[6]=a[5];b[7]=0;b[8]=
a[6];b[9]=a[7];b[10]=a[8];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};D.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,e=0;16>e;e++)c[e]=a[e+b];return this};D.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};D.prototype.equals=function(a){var b=
this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var yd=new w,$b=new f,zd=new w,G=function(){this.name="";this.active=!0;this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=1;this.updateNeighborhood=!1;this.position=new f;this.rotation=new w;this.scale=new f(1,1,1);this.forward=new f(0,0,1);this.up=new f(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.canAcitivateTrigger=!0;this.worldMatrix=new D;this.manager=null;this._localMatrix=
new D;this._cache={position:new f,rotation:new w,scale:new f(1,1,1)};this._renderComponentCallback=this._renderComponent=null;this._started=!1;this._uuid=null};G.prototype.start=function(){};G.prototype.update=function(){};G.prototype.add=function(a){null!==a.parent&&a.parent.remove(a);this.children.push(a);a.parent=this;return this};G.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};G.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};
G.prototype.lookAt=function(a){$b.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,$b,this.up);return this};G.prototype.rotateTo=function(a,b,c){c=void 0===c?.0001:c;$b.subVectors(a,this.position).normalize();yd.lookAt(this.forward,$b,this.up);return this.rotation.rotateTo(yd,this.maxTurnRate*b,c)};G.prototype.getWorldDirection=function(a){zd.extractRotationFromMatrix(this.worldMatrix);return a.copy(this.forward).applyRotation(zd).normalize()};G.prototype.getWorldPosition=
function(a){return a.extractPositionFromMatrix(this.worldMatrix)};G.prototype.updateWorldMatrix=function(a,b){b=void 0===b?!1:b;var c=this.parent,e=this.children;!0===(void 0===a?!1:a)&&null!==c&&c.updateWorldMatrix(!0);this._updateMatrix();null===c?this.worldMatrix.copy(this._localMatrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this._localMatrix);if(!0===b)for(a=0,b=e.length;a<b;a++)e[a].updateWorldMatrix(!1,!0);return this};G.prototype.setRenderComponent=function(a,b){this._renderComponent=
a;this._renderComponentCallback=b;return this};G.prototype.handleMessage=function(){return!1};G.prototype.lineOfSightTest=function(){return null};G.prototype.sendMessage=function(a,b,c,e){null!==this.manager?this.manager.sendMessage(this,a,b,void 0===c?0:c,void 0===e?null:e):y.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.");return this};G.prototype.toJSON=function(){return{type:this.constructor.name,uuid:this.uuid,name:this.name,active:this.active,
children:k(this.children),parent:null!==this.parent?this.parent.uuid:null,neighbors:k(this.neighbors),neighborhoodRadius:this.neighborhoodRadius,updateNeighborhood:this.updateNeighborhood,position:this.position.toArray([]),rotation:this.rotation.toArray([]),scale:this.scale.toArray([]),forward:this.forward.toArray([]),up:this.up.toArray([]),boundingRadius:this.boundingRadius,maxTurnRate:this.maxTurnRate,worldMatrix:this.worldMatrix.toArray([]),_localMatrix:this._localMatrix.toArray([]),_cache:{position:this._cache.position.toArray([]),
rotation:this._cache.rotation.toArray([]),scale:this._cache.scale.toArray([])},_started:this._started}};G.prototype.fromJSON=function(a){this.uuid=a.uuid;this.name=a.name;this.active=a.active;this.neighborhoodRadius=a.neighborhoodRadius;this.updateNeighborhood=a.updateNeighborhood;this.position.fromArray(a.position);this.rotation.fromArray(a.rotation);this.scale.fromArray(a.scale);this.forward.fromArray(a.forward);this.up.fromArray(a.up);this.boundingRadius=a.boundingRadius;this.maxTurnRate=a.maxTurnRate;
this.worldMatrix.fromArray(a.worldMatrix);this.children=a.children.slice();this.neighbors=a.neighbors.slice();this.parent=a.parent;this._localMatrix.fromArray(a._localMatrix);this._cache.position.fromArray(a._cache.position);this._cache.rotation.fromArray(a._cache.rotation);this._cache.scale.fromArray(a._cache.scale);this._started=a._started;return this};G.prototype.resolveReferences=function(a){for(var b=this.neighbors,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c]);b=this.children;c=0;for(e=b.length;c<
e;c++)b[c]=a.get(b[c]);this.parent=a.get(this.parent)||null;return this};G.prototype._updateMatrix=function(){var a=this._cache;if(a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&a.scale.equals(this.scale))return this;this._localMatrix.compose(this.position,this.rotation,this.scale);a.position.copy(this.position);a.rotation.copy(this.rotation);a.scale.copy(this.scale);return this};$jscomp.global.Object.defineProperties(G.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){null===
this._uuid&&(this._uuid=M.generateUUID());return this._uuid},set:function(a){this._uuid=a}}});var Ad=new f,Kc=new f,ia=function(){var a=G.call(this)||this;a.velocity=new f;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(ia,G);ia.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Ad.copy(this.velocity).multiplyScalar(a);Kc.copy(this.position).add(Ad);this.updateOrientation&&1e-8<this.getSpeedSquared()&&
this.lookAt(Kc);this.position.copy(Kc);return this};ia.prototype.getSpeed=function(){return this.velocity.length()};ia.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};ia.prototype.toJSON=function(){var a=G.prototype.toJSON.call(this);a.velocity=this.velocity.toArray([]);a.maxSpeed=this.maxSpeed;a.updateOrientation=this.updateOrientation;return a};ia.prototype.fromJSON=function(a){G.prototype.fromJSON.call(this,a);this.velocity.fromArray(a.velocity);this.maxSpeed=a.maxSpeed;
this.updateOrientation=a.updateOrientation;return this};var p=function(){this.active=!0;this.weight=1};p.prototype.onAdded=function(a){};p.prototype.onRemoved=function(a){};p.prototype.calculate=function(){};p.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,weight:this.weight}};p.prototype.fromJSON=function(a){this.active=a.active;this.weight=a.weight;return this};p.prototype.resolveReferences=function(){};var ac=new f,bc=new f,cc=function(){return p.call(this)||this};
$jscomp.inherits(cc,p);cc.prototype.calculate=function(a,b){ac.set(0,0,0);for(var c=a.neighbors,e=0,h=c.length;e<h;e++)c[e].getDirection(bc),ac.add(bc);0<c.length&&(ac.divideScalar(c.length),a.getDirection(bc),b.subVectors(ac,bc));return b};var Lc=new f,Mc=new f,Da=function(a,b,c){a=void 0===a?new f:a;b=void 0===b?3:b;c=void 0===c?0:c;var e=p.call(this)||this;e.target=a;e.deceleration=b;e.tolerance=c;return e};$jscomp.inherits(Da,p);Da.prototype.calculate=function(a,b){var c=this.deceleration;Mc.subVectors(this.target,
a.position);var e=Mc.length();e>this.tolerance?(c=Math.min(e/c,a.maxSpeed),Lc.copy(Mc).multiplyScalar(c/e)):Lc.set(0,0,0);return b.subVectors(Lc,a.velocity)};Da.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.target=this.target.toArray([]);a.deceleration=this.deceleration;return a};Da.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.deceleration=a.deceleration;return this};var Nc=new f,ya=function(a){a=void 0===a?new f:a;var b=
p.call(this)||this;b.target=a;return b};$jscomp.inherits(ya,p);ya.prototype.calculate=function(a,b){Nc.subVectors(this.target,a.position).normalize();Nc.multiplyScalar(a.maxSpeed);return b.subVectors(Nc,a.velocity)};ya.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.target=this.target.toArray([]);return a};ya.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);return this};var dc=new f,ec=function(){var a=p.call(this)||this;a._seek=new ya;
return a};$jscomp.inherits(ec,p);ec.prototype.calculate=function(a,b){dc.set(0,0,0);for(var c=a.neighbors,e=0,h=c.length;e<h;e++)dc.add(c[e].position);0<c.length&&(dc.divideScalar(c.length),this._seek.target=dc,this._seek.calculate(a,b),b.normalize());return b};var Gb=new f,Sa=function(a,b){a=void 0===a?new f:a;b=void 0===b?10:b;var c=p.call(this)||this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(Sa,p);Sa.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=
this.panicDistance*this.panicDistance&&(Gb.subVectors(a.position,c).normalize(),0===Gb.squaredLength()&&Gb.set(0,0,1),Gb.multiplyScalar(a.maxSpeed),b.subVectors(Gb,a.velocity));return b};Sa.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.target=this.target.toArray([]);a.panicDistance=this.panicDistance;return a};Sa.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.panicDistance=a.panicDistance;return this};var Bd=new f,Cd=new f,
Dd=new f,Ta=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var e=p.call(this)||this;e.pursuer=a;e.panicDistance=b;e.predictionFactor=c;e._flee=new Sa;return e};$jscomp.inherits(Ta,p);Ta.prototype.calculate=function(a,b){var c=this.pursuer;Bd.subVectors(c.position,a.position);var e=Bd.length()/(a.maxSpeed+c.getSpeed());e*=this.predictionFactor;Cd.copy(c.velocity).multiplyScalar(e);Dd.addVectors(c.position,Cd);this._flee.target=Dd;this._flee.panicDistance=this.panicDistance;
this._flee.calculate(a,b);return b};Ta.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.pursuer=this.pursuer?this.pursuer.uuid:null;a.panicDistance=this.panicDistance;a.predictionFactor=this.predictionFactor;return a};Ta.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.pursuer=a.pursuer;this.panicDistance=a.panicDistance;this.predictionFactor=a.predictionFactor;return this};Ta.prototype.resolveReferences=function(a){this.pursuer=a.get(this.pursuer)||null};var za=
function(){this.loop=!1;this._waypoints=[];this._index=0};za.prototype.add=function(a){this._waypoints.push(a);return this};za.prototype.clear=function(){this._index=this._waypoints.length=0;return this};za.prototype.current=function(){return this._waypoints[this._index]};za.prototype.finished=function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===a};za.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);
return this};za.prototype.toJSON=function(){for(var a={type:this.constructor.name,loop:this.loop,_waypoints:[],_index:this._index},b=this._waypoints,c=0,e=b.length;c<e;c++)a._waypoints.push(b[c].toArray([]));return a};za.prototype.fromJSON=function(a){this.loop=a.loop;this._index=a._index;a=a._waypoints;for(var b=0,c=a.length;b<c;b++){var e=a[b];this._waypoints.push((new f).fromArray(e))}return this};var hb=function(a,b){a=void 0===a?new za:a;b=void 0===b?1:b;var c=p.call(this)||this;c.path=a;c.nextWaypointDistance=
b;c._arrive=new Da;c._seek=new ya;return c};$jscomp.inherits(hb,p);hb.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var e=c.current();!0===c.finished()?(this._arrive.target=e,this._arrive.calculate(a,b)):(this._seek.target=e,this._seek.calculate(a,b));return b};hb.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.path=this.path.toJSON();a.nextWaypointDistance=this.nextWaypointDistance;
return a};hb.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.nextWaypointDistance=a.nextWaypointDistance;return this};var fc=new f,gc=new f,Ed=new f,Fd=new f,Ua=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var e=p.call(this)||this;e.entity1=a;e.entity2=b;e.deceleration=c;e._arrive=new Da;return e};$jscomp.inherits(Ua,p);Ua.prototype.calculate=function(a,b){var c=this.entity1,e=this.entity2;fc.addVectors(c.position,e.position).multiplyScalar(.5);
var h=a.position.distanceTo(fc)/a.maxSpeed;gc.copy(c.velocity).multiplyScalar(h);Ed.addVectors(c.position,gc);gc.copy(e.velocity).multiplyScalar(h);Fd.addVectors(e.position,gc);fc.addVectors(Ed,Fd).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=fc;this._arrive.calculate(a,b);return b};Ua.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.entity1=this.entity1?this.entity1.uuid:null;a.entity2=this.entity2?this.entity2.uuid:null;a.deceleration=this.deceleration;
return a};Ua.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.entity1=a.entity1;this.entity2=a.entity2;this.deceleration=a.deceleration;return this};Ua.prototype.resolveReferences=function(a){this.entity1=a.get(this.entity1)||null;this.entity2=a.get(this.entity2)||null};var ma=new f,Hb=new f,Ia=new f,Ea=[new f,new f,new f,new f,new f,new f,new f,new f],E=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.min=a;this.max=b};E.prototype.set=function(a,b){this.min=a;this.max=
b;return this};E.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};E.prototype.clone=function(){return(new this.constructor).copy(this)};E.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return b};E.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};E.prototype.expand=function(a){this.min.min(a);this.max.max(a);return this};E.prototype.getCenter=function(a){return a.addVectors(this.min,
this.max).multiplyScalar(.5)};E.prototype.getSize=function(a){return a.subVectors(this.max,this.min)};E.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0};E.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,ma);return ma.squaredDistanceTo(a.center)<=a.radius*a.radius};E.prototype.intersectsPlane=function(a){var b=a.normal;this.getCenter(Hb);Ia.subVectors(this.max,
Hb);b=Ia.x*Math.abs(b.x)+Ia.y*Math.abs(b.y)+Ia.z*Math.abs(b.z);a=a.distanceToPoint(Hb);return Math.abs(a)<=b};E.prototype.getNormalFromSurfacePoint=function(a,b){b.set(0,0,0);var c=Infinity;this.getCenter(Hb);this.getSize(Ia);ma.copy(a).sub(Hb);a=Math.abs(Ia.x-Math.abs(ma.x));a<c&&(c=a,b.set(1*Math.sign(ma.x),0,0));a=Math.abs(Ia.y-Math.abs(ma.y));a<c&&(c=a,b.set(0,1*Math.sign(ma.y),0));a=Math.abs(Ia.z-Math.abs(ma.z));a<c&&b.set(0,0,1*Math.sign(ma.z));return b};E.prototype.fromCenterAndSize=function(a,
b){ma.copy(b).multiplyScalar(.5);this.min.copy(a).sub(ma);this.max.copy(a).add(ma);return this};E.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);return this};E.prototype.applyMatrix4=function(a){var b=this.min,c=this.max;Ea[0].set(b.x,b.y,b.z).applyMatrix4(a);Ea[1].set(b.x,b.y,c.z).applyMatrix4(a);Ea[2].set(b.x,c.y,b.z).applyMatrix4(a);Ea[3].set(b.x,c.y,c.z).applyMatrix4(a);Ea[4].set(c.x,
b.y,b.z).applyMatrix4(a);Ea[5].set(c.x,b.y,c.z).applyMatrix4(a);Ea[6].set(c.x,c.y,b.z).applyMatrix4(a);Ea[7].set(c.x,c.y,c.z).applyMatrix4(a);return this.fromPoints(Ea)};E.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};E.prototype.toJSON=function(){return{type:this.constructor.name,min:this.min.toArray([]),max:this.max.toArray([])}};E.prototype.fromJSON=function(a){this.min.fromArray(a.min);this.max.fromArray(a.max);return this};var Oc=new E,R=function(a,b){this.center=
a=void 0===a?new f:a;this.radius=void 0===b?0:b};R.prototype.set=function(a,b){this.center=a;this.radius=b;return this};R.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};R.prototype.clone=function(){return(new this.constructor).copy(this)};R.prototype.clampPoint=function(a,b){b.copy(a);this.center.squaredDistanceTo(a)>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b};R.prototype.containsPoint=
function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};R.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=b*b};R.prototype.intersectsPlane=function(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius};R.prototype.getNormalFromSurfacePoint=function(a,b){return b.subVectors(a,this.center).normalize()};R.prototype.fromPoints=function(a){Oc.fromPoints(a);Oc.getCenter(this.center);this.radius=this.center.distanceTo(Oc.max);
return this};R.prototype.applyMatrix4=function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScale();return this};R.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};R.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),radius:this.radius}};R.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.radius=a.radius;return this};var na=new f,Pc=new f,hc=new f,Qc=new f,Gd=new f,ic=new D,ye=new D,Hd=new E,
K=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.origin=a;this.direction=b};K.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};K.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};K.prototype.clone=function(){return(new this.constructor).copy(this)};K.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};K.prototype.intersectBoundingSphere=function(a,b){na.subVectors(a.center,
this.origin);var c=na.dot(this.direction),e=na.dot(na)-c*c;a=a.radius*a.radius;if(e>a)return null;a=Math.sqrt(a-e);e=c-a;c+=a;return 0>e&&0>c?null:0>e?this.at(c,b):this.at(e,b)};K.prototype.intersectsBoundingSphere=function(a){var b=new f,c=b.subVectors(a.center,this.origin).dot(this.direction);0>c?b=this.origin.squaredDistanceTo(a.center):(b.copy(this.direction).multiplyScalar(c).add(this.origin),b=b.squaredDistanceTo(a.center));return b<=a.radius*a.radius};K.prototype.intersectAABB=function(a,b){var c=
1/this.direction.x;var e=1/this.direction.y;var h=1/this.direction.z,n=this.origin;if(0<=c){var d=(a.min.x-n.x)*c;c*=a.max.x-n.x}else d=(a.max.x-n.x)*c,c*=a.min.x-n.x;if(0<=e){var l=(a.min.y-n.y)*e;e*=a.max.y-n.y}else l=(a.max.y-n.y)*e,e*=a.min.y-n.y;if(d>e||l>c)return null;if(l>d||d!==d)d=l;if(e<c||c!==c)c=e;0<=h?(l=(a.min.z-n.z)*h,a=(a.max.z-n.z)*h):(l=(a.max.z-n.z)*h,a=(a.min.z-n.z)*h);if(d>a||l>c)return null;if(l>d||d!==d)d=l;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=d?d:c,b)};K.prototype.intersectsAABB=
function(a){return null!==this.intersectAABB(a,na)};K.prototype.intersectPlane=function(a,b){var c=a.normal.dot(this.direction);if(0===c)if(0===a.distanceToPoint(this.origin))a=0;else return null;else a=-(this.origin.dot(a.normal)+a.constant)/c;return 0<=a?this.at(a,b):null};K.prototype.intersectsPlane=function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1};K.prototype.intersectOBB=function(a,b){a.getSize(Gd);Hd.fromCenterAndSize(na.set(0,0,0),Gd);ic.fromMatrix3(a.rotation);
ic.setPosition(a.center);Id.copy(this).applyMatrix4(ic.getInverse(ye));return Id.intersectAABB(Hd,b)?b.applyMatrix4(ic):null};K.prototype.intersectsOBB=function(a){return null!==this.intersectOBB(a,na)};K.prototype.intersectConvexHull=function(a,b){a=a.faces;for(var c=-Infinity,e=Infinity,h=0,n=a.length;h<n;h++){var d=a[h].plane,l=d.distanceToPoint(this.origin);d=d.normal.dot(this.direction);if(0<l&&0<=d)return null;l=0!==d?-l/d:0;if(!(0>=l)&&(0<d?e=Math.min(l,e):c=Math.max(l,c),c>e))return null}-Infinity!==
c?this.at(c,b):this.at(e,b);return b};K.prototype.intersectsConvexHull=function(a){return null!==this.intersectConvexHull(a,na)};K.prototype.intersectTriangle=function(a,b,c){var e=a.a,h=a.c;Pc.subVectors(a.b,e);hc.subVectors(h,e);Qc.crossVectors(Pc,hc);a=this.direction.dot(Qc);if(0<a){if(b)return null;b=1}else if(0>a)b=-1,a=-a;else return null;na.subVectors(this.origin,e);e=b*this.direction.dot(hc.crossVectors(na,hc));if(0>e)return null;h=b*this.direction.dot(Pc.cross(na));if(0>h||e+h>a)return null;
e=-b*na.dot(Qc);return 0>e?null:this.at(e/a,c)};K.prototype.intersectBVH=function(a,b){return a.root.intersectRay(this,b)};K.prototype.intersectsBVH=function(a){return a.root.intersectsRay(this)};K.prototype.applyMatrix4=function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this};K.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var Id=new K,Jd=new D,ib=new f,jc=new f,Rc=new f,Sc=new R,ze=new K(new f(0,0,0),new f(0,
0,1)),Va=function(a){a=void 0===a?[]:a;var b=p.call(this)||this;b.obstacles=a;b.brakingWeight=.2;b.dBoxMinLength=4;return b};$jscomp.inherits(Va,p);Va.prototype.calculate=function(a,b){var c=this.obstacles,e=null,h=Infinity,n=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;a.worldMatrix.getInverse(Jd);for(var d=0,l=c.length;d<l;d++){var f=c[d];if(f!==a&&(ib.copy(f.position).applyMatrix4(Jd),0<ib.z&&Math.abs(ib.z)<n)){var g=f.boundingRadius+a.boundingRadius;Math.abs(ib.x)<g&&(Sc.center.copy(ib),
Sc.radius=g,ze.intersectBoundingSphere(Sc,Rc),Rc.z<h&&(h=Rc.z,e=f,jc.copy(ib)))}}null!==e&&(b.x=(e.boundingRadius-jc.x)*(1+(n-jc.z)/n),b.z=(e.boundingRadius-jc.z)*this.brakingWeight,b.applyRotation(a.rotation));return b};Va.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.obstacles=[];a.brakingWeight=this.brakingWeight;a.dBoxMinLength=this.dBoxMinLength;for(var b=0,c=this.obstacles.length;b<c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};Va.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,
a);this.obstacles=a.obstacles;this.brakingWeight=a.brakingWeight;this.dBoxMinLength=a.dBoxMinLength;return this};Va.prototype.resolveReferences=function(a){for(var b=this.obstacles,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c])};var Tc=new f,Kd=new f,Ld=new f,Md=new f,Wa=function(a,b){a=void 0===a?null:a;b=void 0===b?new f:b;var c=p.call(this)||this;c.leader=a;c.offset=b;c._arrive=new Da;c._arrive.deceleration=1.5;return c};$jscomp.inherits(Wa,p);Wa.prototype.calculate=function(a,b){var c=this.leader;Tc.copy(this.offset).applyMatrix4(c.worldMatrix);
Kd.subVectors(Tc,a.position);var e=Kd.length()/(a.maxSpeed+c.getSpeed());Ld.copy(c.velocity).multiplyScalar(e);Md.addVectors(Tc,Ld);this._arrive.target=Md;this._arrive.calculate(a,b);return b};Wa.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.leader=this.leader?this.leader.uuid:null;a.offset=this.offset;return a};Wa.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.leader=a.leader;this.offset=a.offset;return this};Wa.prototype.resolveReferences=function(a){this.leader=
a.get(this.leader)||null};var Uc=new f,Vc=new f,Nd=new f,Od=new f,Pd=new f,Xa=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=p.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new ya;return c};$jscomp.inherits(Xa,p);Xa.prototype.calculate=function(a,b){var c=this.evader;Uc.subVectors(c.position,a.position);a.getDirection(Vc);c.getDirection(Nd);var e=0<Uc.dot(Vc),h=-.95>Vc.dot(Nd);if(!0===e&&!0===h)return this._seek.target=c.position,this._seek.calculate(a,b),b;e=Uc.length()/(a.maxSpeed+
c.getSpeed());e*=this.predictionFactor;Od.copy(c.velocity).multiplyScalar(e);Pd.addVectors(c.position,Od);this._seek.target=Pd;this._seek.calculate(a,b);return b};Xa.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.evader=this.evader?this.evader.uuid:null;a.predictionFactor=this.predictionFactor;return a};Xa.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.evader=a.evader;this.predictionFactor=a.predictionFactor;return this};Xa.prototype.resolveReferences=function(a){this.evader=
a.get(this.evader)||null};var kc=new f,lc=function(){return p.call(this)||this};$jscomp.inherits(lc,p);lc.prototype.calculate=function(a,b){for(var c=a.neighbors,e=0,h=c.length;e<h;e++){kc.subVectors(a.position,c[e].position);var n=kc.length();0===n&&(n=.0001);kc.normalize().divideScalar(n);b.add(kc)}return b};var Ib=new f,Wc=new f,jb=function(a,b,c){a=void 0===a?1:a;b=void 0===b?5:b;c=void 0===c?5:c;var e=p.call(this)||this;e.radius=a;e.distance=b;e.jitter=c;e._targetLocal=new f;a=e.radius;b=e._targetLocal;
c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);return e};$jscomp.inherits(jb,p);jb.prototype.calculate=function(a,b,c){c*=this.jitter;Wc.x=M.randFloat(-1,1)*c;Wc.z=M.randFloat(-1,1)*c;this._targetLocal.add(Wc);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);Ib.copy(this._targetLocal);Ib.z+=this.distance;Ib.applyMatrix4(a.worldMatrix);b.subVectors(Ib,a.position);return b};jb.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.radius=this.radius;
a.distance=this.distance;a.jitter=this.jitter;a._targetLocal=this._targetLocal.toArray([]);return a};jb.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.radius=a.radius;this.distance=a.distance;this.jitter=a.jitter;this._targetLocal.fromArray(a._targetLocal);return this};var mc=new f,ja=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=new f;this._typesMap=new Map};ja.prototype.add=function(a){this.behaviors.push(a);a.onAdded(this.vehicle);return this};ja.prototype.remove=
function(a){var b=this.behaviors.indexOf(a);this.behaviors.splice(b,1);a.onRemoved(this.vehicle);return this};ja.prototype.clear=function(){this.behaviors.length=0;return this};ja.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};ja.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};ja.prototype._calculateByOrder=
function(a){var b=this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,e=b.length;c<e;c++){var h=b[c];if(!0===h.active&&(mc.set(0,0,0),h.calculate(this.vehicle,mc,a),mc.multiplyScalar(h.weight),!1===this._accumulate(mc)))break}};ja.prototype.toJSON=function(){for(var a={type:"SteeringManager",behaviors:[]},b=this.behaviors,c=0,e=b.length;c<e;c++)a.behaviors.push(b[c].toJSON());return a};ja.prototype.fromJSON=function(a){this.clear();a=a.behaviors;for(var b=0,c=a.length;b<c;b++){var e=a[b],h=
e.type;switch(h){case "SteeringBehavior":e=(new p).fromJSON(e);break;case "AlignmentBehavior":e=(new cc).fromJSON(e);break;case "ArriveBehavior":e=(new Da).fromJSON(e);break;case "CohesionBehavior":e=(new ec).fromJSON(e);break;case "EvadeBehavior":e=(new Ta).fromJSON(e);break;case "FleeBehavior":e=(new Sa).fromJSON(e);break;case "FollowPathBehavior":e=(new hb).fromJSON(e);break;case "InterposeBehavior":e=(new Ua).fromJSON(e);break;case "ObstacleAvoidanceBehavior":e=(new Va).fromJSON(e);break;case "OffsetPursuitBehavior":e=
(new Wa).fromJSON(e);break;case "PursuitBehavior":e=(new Xa).fromJSON(e);break;case "SeekBehavior":e=(new ya).fromJSON(e);break;case "SeparationBehavior":e=(new lc).fromJSON(e);break;case "WanderBehavior":e=(new jb).fromJSON(e);break;default:var n=this._typesMap.get(h);if(void 0!==n)e=(new n).fromJSON(e);else{y.warn("YUKA.SteeringManager: Unsupported steering behavior type:",h);continue}}this.add(e)}return this};ja.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};ja.prototype.resolveReferences=
function(a){for(var b=this.behaviors,c=0,e=b.length;c<e;c++)b[c].resolveReferences(a);return this};var Jb=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new f};Jb.prototype.calculate=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;for(a=0;a<this.count;a++)b.add(this._history[a]);b.divideScalar(this.count);return b};Jb.prototype.toJSON=function(){for(var a={type:this.constructor.name,
count:this.count,_history:[],_slot:this._slot},b=this._history,c=0,e=b.length;c<e;c++)a._history.push(b[c].toArray([]));return a};Jb.prototype.fromJSON=function(a){this.count=a.count;this._slot=a._slot;a=a._history;for(var b=this._history.length=0,c=a.length;b<c;b++){var e=a[b];this._history.push((new f).fromArray(e))}return this};var Qd=new f,nc=new f,Rd=new f,Kb=new f,Sd=new f,Ya=function(){var a=ia.call(this)||this;a.mass=1;a.maxForce=100;a.steering=new ja(a);a.smoother=null;return a};$jscomp.inherits(Ya,
ia);Ya.prototype.update=function(a){this.steering.calculate(a,Qd);Rd.copy(Qd).divideScalar(this.mass);this.velocity.add(Rd.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));nc.copy(this.velocity).multiplyScalar(a);Kb.copy(this.position).add(nc);!0===this.updateOrientation&&null===this.smoother&&1e-8<this.getSpeedSquared()&&this.lookAt(Kb);this.position.copy(Kb);!0===this.updateOrientation&&null!==this.smoother&&
(this.smoother.calculate(this.velocity,Sd),nc.copy(Sd).multiplyScalar(a),Kb.copy(this.position).add(nc),this.lookAt(Kb));return this};Ya.prototype.toJSON=function(){var a=ia.prototype.toJSON.call(this);a.mass=this.mass;a.maxForce=this.maxForce;a.steering=this.steering.toJSON();a.smoother=this.smoother?this.smoother.toJSON():null;return a};Ya.prototype.fromJSON=function(a){ia.prototype.fromJSON.call(this,a);this.mass=a.mass;this.maxForce=a.maxForce;this.steering=(new ja(this)).fromJSON(a.steering);
this.smoother=a.smoother?(new Jb).fromJSON(a.smoother):null;return this};Ya.prototype.resolveReferences=function(a){ia.prototype.resolveReferences.call(this,a);this.steering.resolveReferences(a)};var oa=function(){};oa.prototype.touching=function(){return!1};oa.prototype.toJSON=function(){return{type:this.constructor.name}};oa.prototype.fromJSON=function(){return this};var Td=new R,Ja=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this._aabb=new E(a,b);return this};$jscomp.inherits(Ja,oa);
Ja.prototype.fromPositionAndSize=function(a,b){this._aabb.fromCenterAndSize(a,b);return this};Ja.prototype.touching=function(a){Td.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(Td)};Ja.prototype.toJSON=function(){var a=oa.prototype.toJSON.call(this);a._aabb=this._aabb.toJSON();return a};Ja.prototype.fromJSON=function(a){oa.prototype.fromJSON.call(this,a);this._aabb.fromJSON(a._aabb);return this};$jscomp.global.Object.defineProperties(Ja.prototype,{min:{configurable:!0,
enumerable:!0,get:function(){return this._aabb.min},set:function(a){this._aabb.min=a}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var Ud=new R,Za=function(a,b){a=void 0===a?new f:a;this._boundingSphere=new R(a,void 0===b?0:b);return this};$jscomp.inherits(Za,oa);Za.prototype.touching=function(a){Ud.set(a.position,a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(Ud)};Za.prototype.toJSON=function(){var a=oa.prototype.toJSON.call(this);
a._boundingSphere=this._boundingSphere.toJSON();return a};Za.prototype.fromJSON=function(a){oa.prototype.fromJSON.call(this,a);this._boundingSphere.fromJSON(a._boundingSphere);return this};$jscomp.global.Object.defineProperties(Za.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},set:function(a){this._boundingSphere.center=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=
a}}});var Ka=function(a){a=void 0===a?new oa:a;this.active=!0;this.region=a;this._typesMap=new Map};Ka.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a);return this};Ka.prototype.execute=function(){};Ka.prototype.update=function(){};Ka.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,region:this.region.toJSON()}};Ka.prototype.fromJSON=function(a){this.active=a.active;a=a.region;var b=a.type;switch(b){case "TriggerRegion":this.region=
(new oa).fromJSON(a);break;case "RectangularTriggerRegion":this.region=(new Ja).fromJSON(a);break;case "SphericalTriggerRegion":this.region=(new Za).fromJSON(a);break;default:b=this._typesMap.get(b),void 0!==b?this.region=(new b).fromJSON(a):y.warn("YUKA.Trigger: Unsupported trigger region type:",a.type)}return this};Ka.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var kb=[],ca=function(){this.entities=[];this.triggers=[];this.spatialIndex=null;this._indexMap=new Map;this._typesMap=
new Map;this._messageDispatcher=new ta};ca.prototype.add=function(a){this.entities.push(a);a.manager=this;return this};ca.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);a.manager=null;return this};ca.prototype.addTrigger=function(a){this.triggers.push(a);return this};ca.prototype.removeTrigger=function(a){a=this.triggers.indexOf(a);this.triggers.splice(a,1);return this};ca.prototype.clear=function(){this.entities.length=0;this.triggers.length=0;this._messageDispatcher.clear();
return this};ca.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,e=b.length;c<e;c++){var h=b[c];if(h.name===a)return h}return null};ca.prototype.update=function(a){for(var b=this.entities,c=this.triggers,e=b.length-1;0<=e;e--)this.updateEntity(b[e],a);for(b=c.length-1;0<=b;b--)this.updateTrigger(c[b],a);this._messageDispatcher.dispatchDelayedMessages(a);return this};ca.prototype.updateEntity=function(a,b){if(!0===a.active){this.updateNeighborhood(a);!1===a._started&&(a.start(),a._started=
!0);a.update(b);a.updateWorldMatrix();for(var c=a.children,e=c.length-1;0<=e;e--)this.updateEntity(c[e],b);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b));b=a._renderComponent;c=a._renderComponentCallback;null!==b&&null!==c&&c(a,b)}return this};ca.prototype.updateNeighborhood=function(a){if(!0===a.updateNeighborhood){a.neighbors.length=0;null!==this.spatialIndex?this.spatialIndex.query(a.position,a.neighborhoodRadius,kb):(kb.length=
0,kb.push.apply(kb,$jscomp.arrayFromIterable(this.entities)));for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,e=kb.length;c<e;c++){var h=kb[c];a!==h&&!0===h.active&&a.position.squaredDistanceTo(h.position)<=b&&a.neighbors.push(h)}}return this};ca.prototype.updateTrigger=function(a,b){if(!0===a.active){a.update(b);b=this.entities;for(var c=b.length-1;0<=c;c--){var e=b[c];!0===e.active&&e.canAcitivateTrigger&&a.check(e)}}return this};ca.prototype.sendMessage=function(a,b,c,e,h){this._messageDispatcher.dispatch(a,
b,c,e,h);return this};ca.prototype.toJSON=function(){function a(c){b.entities.push(c.toJSON());for(var e=0,h=c.children.length;e<h;e++)a(c.children[e])}for(var b={type:this.constructor.name,entities:[],triggers:[],_messageDispatcher:this._messageDispatcher.toJSON()},c=0,e=this.entities.length;c<e;c++)a(this.entities[c]);c=0;for(e=this.triggers.length;c<e;c++)b.triggers.push(this.triggers[c].toJSON());return b};ca.prototype.fromJSON=function(a){this.clear();var b=a.entities,c=a.triggers;a=a._messageDispatcher;
for(var e=new Map,h=0,n=b.length;h<n;h++){var d=b[h],l=d.type;switch(l){case "GameEntity":d=(new G).fromJSON(d);break;case "MovingEntity":d=(new ia).fromJSON(d);break;case "Vehicle":d=(new Ya).fromJSON(d);break;default:var f=this._typesMap.get(l);if(void 0!==f)d=(new f).fromJSON(d);else{y.warn("YUKA.EntityManager: Unsupported entity type:",l);continue}}e.set(d.uuid,d);null===d.parent&&this.add(d)}b=$jscomp.makeIterator(e.values());for(h=b.next();!h.done;h=b.next())h.value.resolveReferences(e);e=0;
for(b=c.length;e<b;e++){h=c[e];n=h.type;if("Trigger"===n)h=(new Ka).fromJSON(h);else if(d=this._typesMap.get(n),void 0!==d)h=(new d).fromJSON(h);else{y.warn("YUKA.EntityManager: Unsupported trigger type:",n);continue}this.addTrigger(h)}this._messageDispatcher.fromJSON(a);return this};ca.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var Lb=function(){this._events=new Map};Lb.prototype.addEventListener=function(a,b){var c=this._events;!1===c.has(a)&&c.set(a,[]);a=c.get(a);
-1===a.indexOf(b)&&a.push(b)};Lb.prototype.removeEventListener=function(a,b){a=this._events.get(a);void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))};Lb.prototype.hasEventListener=function(a,b){a=this._events.get(a);return void 0!==a&&-1!==a.indexOf(b)};Lb.prototype.dispatchEvent=function(a){var b=this._events.get(a.type);if(void 0!==b){a.target=this;for(var c=0,e=b.length;c<e;c++)b[c].call(this,a)}};var lb=new f,Xc=new f,oc=new f,ea=function(a,b){this.normal=a=void 0===a?new f(0,0,1):a;this.constant=
void 0===b?0:b};ea.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};ea.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};ea.prototype.clone=function(){return(new this.constructor).copy(this)};ea.prototype.distanceToPoint=function(a){return this.normal.dot(a)+this.constant};ea.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};ea.prototype.fromCoplanarPoints=function(a,
b,c){lb.subVectors(c,b).cross(Xc.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(lb,a);return this};ea.prototype.intersectPlane=function(a,b){oc.crossVectors(this.normal,a.normal);var c=oc.dot(oc);if(0===c)return null;lb.copy(a.normal).multiplyScalar(this.constant);Xc.copy(this.normal).multiplyScalar(a.constant);b.crossVectors(lb.sub(Xc),oc).divideScalar(c);return b};ea.prototype.intersectsPlane=function(a){a=this.normal.dot(a.normal);return 1!==Math.abs(a)};ea.prototype.projectPoint=
function(a,b){lb.copy(this.normal).multiplyScalar(this.distanceToPoint(a));b.subVectors(a,lb);return b};ea.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var Vd=new R,S={a:new f,b:new f,c:new f},mb=new K,Wd=new ea,Xd=new D,Yc=new f,Zc=new f,$c=new f,ad=new f,$a=function(a,b){this.vertices=a=void 0===a?new Float32Array:a;this.indices=void 0===b?null:b;this.backfaceCulling=!0;this.aabb=new E;this.boundingSphere=new R;this.computeBoundingVolume()};$a.prototype.computeBoundingVolume=
function(){var a=this.vertices,b=new f,c=this.aabb,e=this.boundingSphere;c.min.set(Infinity,Infinity,Infinity);c.max.set(-Infinity,-Infinity,-Infinity);for(var h=0,d=a.length;h<d;h+=3)b.x=a[h],b.y=a[h+1],b.z=a[h+2],c.expand(b);c.getCenter(e.center);e.radius=e.center.distanceTo(c.max);return this};$a.prototype.intersectRay=function(a,b,c,e,h){h=void 0===h?null:h;Vd.copy(this.boundingSphere).applyMatrix4(b);if(a.intersectsBoundingSphere(Vd)&&(b.getInverse(Xd),mb.copy(a).applyMatrix4(Xd),mb.intersectsAABB(this.aabb))){a=
this.vertices;var d=this.indices,z=Infinity,l=!1;if(null===d){d=0;for(var f=a.length;d<f;d+=9)if(S.a.set(a[d],a[d+1],a[d+2]),S.b.set(a[d+3],a[d+4],a[d+5]),S.c.set(a[d+6],a[d+7],a[d+8]),null!==mb.intersectTriangle(S,this.backfaceCulling,e))if(c){var g=e.squaredDistanceTo(mb.origin);g<z&&(z=g,Yc.copy(e),Zc.copy(S.a),$c.copy(S.b),ad.copy(S.c),l=!0)}else{l=!0;break}}else for(f=0,g=d.length;f<g;f+=3){var k=d[f],m=d[f+1],p=d[f+2];S.a.set(a[3*k],a[3*k+1],a[3*k+2]);S.b.set(a[3*m],a[3*m+1],a[3*m+2]);S.c.set(a[3*
p],a[3*p+1],a[3*p+2]);if(null!==mb.intersectTriangle(S,this.backfaceCulling,e))if(c)k=e.squaredDistanceTo(mb.origin),k<z&&(z=k,Yc.copy(e),Zc.copy(S.a),$c.copy(S.b),ad.copy(S.c),l=!0);else{l=!0;break}}if(l)return c&&(e.copy(Yc),S.a.copy(Zc),S.b.copy($c),S.c.copy(ad)),e.applyMatrix4(b),null!==h&&(Wd.fromCoplanarPoints(S.a,S.b,S.c),h.copy(Wd.normal),h.transformDirection(b)),e}return null};$a.prototype.toTriangleSoup=function(){var a=this.indices,b=this.vertices;if(a){var c=new Float32Array(3*a.length);
for(var e=0,h=a.length;e<h;e++){var d=a[e];c[3*e]=b[3*d];c[3*e+1]=b[3*d+1];c[3*e+2]=b[3*d+2]}}else c=new Float32Array(b);return new $a(c)};$a.prototype.toJSON=function(){var a={type:this.constructor.name};a.indices={type:this.indices?this.indices.constructor.name:"null",data:this.indices?Array.from(this.indices):null};a.vertices=Array.from(this.vertices);a.backfaceCulling=this.backfaceCulling;a.aabb=this.aabb.toJSON();a.boundingSphere=this.boundingSphere.toJSON();return a};$a.prototype.fromJSON=function(a){this.aabb=
(new E).fromJSON(a.aabb);this.boundingSphere=(new R).fromJSON(a.boundingSphere);this.backfaceCulling=a.backfaceCulling;this.vertices=new Float32Array(a.vertices);switch(a.indices.type){case "Uint16Array":this.indices=new Uint16Array(a.indices.data);break;case "Uint32Array":this.indices=new Uint32Array(a.indices.data);break;case "null":this.indices=null}return this};var nb=function(){this.previousTime=0;this.currentTime=this.now();this.detectPageVisibility=!0;"undefined"!==typeof document&&void 0!==
document.hidden&&(this._pageVisibilityHandler=g.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1));this._deltaTime=this._elapsedTime=0};nb.prototype.getDelta=function(){return this._deltaTime/1E3};nb.prototype.getElapsed=function(){return this._elapsedTime/1E3};nb.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();this._deltaTime=this.currentTime-this.previousTime;this._elapsedTime+=this._deltaTime;return this};nb.prototype.now=
function(){return("undefined"===typeof performance?Date:performance).now()};var Yd=function(a){this.updateFrequency=void 0===a?0:a;this._time=new nb;this._nextUpdateTime=0};Yd.prototype.ready=function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var Fa=function(){};Fa.prototype.enter=function(){};Fa.prototype.execute=function(){};Fa.prototype.exit=function(){};Fa.prototype.toJSON=function(){};
Fa.prototype.fromJSON=function(){};Fa.prototype.resolveReferences=function(){};Fa.prototype.onMessage=function(){return!1};var fa=function(a){this.owner=void 0===a?null:a;this.globalState=this.previousState=this.currentState=null;this.states=new Map;this._typesMap=new Map};fa.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner);return this};fa.prototype.add=function(a,b){b instanceof Fa?this.states.set(a,
b):y.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".');return this};fa.prototype.remove=function(a){this.states.delete(a);return this};fa.prototype.get=function(a){return this.states.get(a)};fa.prototype.changeTo=function(a){a=this.get(a);this._change(a);return this};fa.prototype.revert=function(){this._change(this.previousState);return this};fa.prototype.in=function(a){return this.get(a)===this.currentState};fa.prototype.handleMessage=function(a){return null!==this.currentState&&
!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};fa.prototype.toJSON=function(){for(var a={owner:this.owner.uuid,currentState:null,previousState:null,globalState:null,states:[]},b=new Map,c=$jscomp.makeIterator(this.states),e=c.next();!e.done;e=c.next()){var h=$jscomp.makeIterator(e.value);e=h.next().value;h=h.next().value;a.states.push({type:h.constructor.name,id:e,state:h.toJSON()});b.set(h,e)}a.currentState=b.get(this.currentState)||
null;a.previousState=b.get(this.previousState)||null;a.globalState=b.get(this.globalState)||null;return a};fa.prototype.fromJSON=function(a){this.owner=a.owner;for(var b=a.states,c=0,e=b.length;c<e;c++){var h=b[c],d=h.type,z=this._typesMap.get(d);void 0!==z?(d=h.id,h=(new z).fromJSON(h.state),this.add(d,h)):y.warn("YUKA.StateMachine: Unsupported state type:",d)}this.currentState=null!==a.currentState?this.get(a.currentState)||null:null;this.previousState=null!==a.previousState?this.get(a.previousState)||
null:null;this.globalState=null!==a.globalState?this.get(a.globalState)||null:null;return this};fa.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=$jscomp.makeIterator(this.states.values()),c=b.next();!c.done;c=b.next())c.value.resolveReferences(a);return this};fa.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};fa.prototype._change=function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;
this.currentState.enter(this.owner)};var Ga=function(){};Ga.prototype.clearDegreeOfMembership=function(){};Ga.prototype.getDegreeOfMembership=function(){};Ga.prototype.updateDegreeOfMembership=function(){};Ga.prototype.toJSON=function(){return{type:this.constructor.name}};var aa=function(a){this.terms=a=void 0===a?[]:a;return this};$jscomp.inherits(aa,Ga);aa.prototype.clearDegreeOfMembership=function(){for(var a=this.terms,b=0,c=a.length;b<c;b++)a[b].clearDegreeOfMembership();return this};aa.prototype.updateDegreeOfMembership=
function(a){for(var b=this.terms,c=0,e=b.length;c<e;c++)b[c].updateDegreeOfMembership(a);return this};aa.prototype.toJSON=function(){var a=Ga.prototype.toJSON.call(this);a.terms=[];for(var b=0,c=this.terms.length;b<c;b++){var e=this.terms[b];e instanceof aa?a.terms.push(e.toJSON()):a.terms.push(e.uuid)}return a};var pc=function(){var a=Array.from(arguments);return aa.call(this,a)||this};$jscomp.inherits(pc,aa);pc.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=Infinity,c=0,e=a.length;c<
e;c++){var h=a[c].getDegreeOfMembership();h<b&&(b=h)}return b};var ob=function(a){a=void 0===a?null:a;return aa.call(this,null!==a?[a]:[])||this};$jscomp.inherits(ob,aa);ob.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};ob.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();return Math.sqrt(a)};ob.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(Math.sqrt(a));return this};var qc=
function(){var a=Array.from(arguments);return aa.call(this,a)||this};$jscomp.inherits(qc,aa);qc.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=-Infinity,c=0,e=a.length;c<e;c++){var h=a[c].getDegreeOfMembership();h>b&&(b=h)}return b};var pb=function(a){a=void 0===a?null:a;return aa.call(this,null!==a?[a]:[])||this};$jscomp.inherits(pb,aa);pb.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};pb.prototype.getDegreeOfMembership=function(){var a=
this.terms[0].getDegreeOfMembership();return a*a};pb.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(a*a);return this};var x=function(a){this.degreeOfMembership=0;this.representativeValue=void 0===a?0:a;this.right=this.left=0;this._uuid=null;return this};$jscomp.inherits(x,Ga);x.prototype.computeDegreeOfMembership=function(){};x.prototype.clearDegreeOfMembership=function(){this.degreeOfMembership=0;return this};x.prototype.getDegreeOfMembership=function(){return this.degreeOfMembership};
x.prototype.updateDegreeOfMembership=function(a){a>this.degreeOfMembership&&(this.degreeOfMembership=a);return this};x.prototype.toJSON=function(){var a=Ga.prototype.toJSON.call(this);a.degreeOfMembership=this.degreeOfMembership;a.representativeValue=this.representativeValue;a.left=this.left;a.right=this.right;a.uuid=this.uuid;return a};x.prototype.fromJSON=function(a){this.degreeOfMembership=a.degreeOfMembership;this.representativeValue=a.representativeValue;this.left=a.left;this.right=a.right;this.uuid=
a.uuid;return this};$jscomp.global.Object.defineProperties(x.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){null===this._uuid&&(this._uuid=M.generateUUID());return this._uuid},set:function(a){this._uuid=a}}});var Mb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,(b+a)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(Mb,x);Mb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.right;return a>=this.left&&
a<=b?1:a>b&&a<=c?a>=(b+c)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):0};Mb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};Mb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var qb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,(b+a)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(qb,x);qb.prototype.computeDegreeOfMembership=
function(a){var b=this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?1/(c-b)*(c-a):0};qb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};qb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var rb=function(a,b,c,e){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;e=void 0===e?0:e;var h=x.call(this,b)||this;h.left=a;h.midpoint=b;h.right=c;h.standardDeviation=e;h._cache={};return h};
$jscomp.inherits(rb,x);rb.prototype.computeDegreeOfMembership=function(a){this._updateCache();return a>=this.right||a<=this.left?0:r(a,this.midpoint,this._cache.variance)/this._cache.normalizationFactor};rb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;a.standardDeviation=this.standardDeviation;return a};rb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;this.standardDeviation=a.standardDeviation;return this};rb.prototype._updateCache=
function(){var a=this._cache,b=this.midpoint,c=this.standardDeviation;if(b!==a.midpoint||c!==a.standardDeviation){var e=c*c;a.midpoint=b;a.standardDeviation=c;a.variance=e;a.normalizationFactor=r(b,b,e)}return this};var Nb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,(b+c)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(Nb,x);Nb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,e=this.right;return a>=c&&a<=b?
a<=(c+b)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):a>b&&a<=e?1:0};Nb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};Nb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var sb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,(b+c)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(sb,x);sb.prototype.computeDegreeOfMembership=function(a){var b=
this.midpoint,c=this.left,e=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=e?1:0};sb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};sb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var tb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,b)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(tb,x);tb.prototype.computeDegreeOfMembership=function(a){var b=
this.right;return a>=this.left&&a<=b?1:0};tb.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};tb.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var ub=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=x.call(this,b)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(ub,x);ub.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,e=
this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=e?1/(e-b)*(e-a):0};ub.prototype.toJSON=function(){var a=x.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};ub.prototype.fromJSON=function(a){x.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var vb=function(a,b){this.antecedent=void 0===a?null:a;this.consequence=void 0===b?null:b};vb.prototype.initConsequence=function(){this.consequence.clearDegreeOfMembership();return this};vb.prototype.evaluate=function(){this.consequence.updateDegreeOfMembership(this.antecedent.getDegreeOfMembership());
return this};vb.prototype.toJSON=function(){var a={},b=this.antecedent,c=this.consequence;a.type=this.constructor.name;a.antecedent=b instanceof aa?b.toJSON():b.uuid;a.consequence=c instanceof aa?c.toJSON():c.uuid;return a};vb.prototype.fromJSON=function(a,b){function c(a){if("string"===typeof a)return b.get(a)||null;var e=a.type;switch(e){case "FuzzyAND":e=new pc;break;case "FuzzyOR":e=new qc;break;case "FuzzyVERY":e=new pb;break;case "FuzzyFAIRLY":e=new ob;break;default:y.error("YUKA.FuzzyRule: Unsupported operator type:",
e);return}a=a.terms;for(var d=0,z=a.length;d<z;d++)e.terms.push(c(a[d]));return e}this.antecedent=c(a.antecedent);this.consequence=c(a.consequence);return this};var Ha=function(){this.fuzzySets=[];this.minRange=Infinity;this.maxRange=-Infinity};Ha.prototype.add=function(a){this.fuzzySets.push(a);a.left<this.minRange&&(this.minRange=a.left);a.right>this.maxRange&&(this.maxRange=a.right);return this};Ha.prototype.remove=function(a){var b=this.fuzzySets;a=b.indexOf(a);b.splice(a,1);this.minRange=Infinity;
this.maxRange=-Infinity;a=0;for(var c=b.length;a<c;a++){var e=b[a];e.left<this.minRange&&(this.minRange=e.left);e.right>this.maxRange&&(this.maxRange=e.right)}return this};Ha.prototype.fuzzify=function(a){if(a<this.minRange||a>this.maxRange)y.warn("YUKA.FuzzyVariable: Value for fuzzification out of range.");else{for(var b=this.fuzzySets,c=0,e=b.length;c<e;c++){var h=b[c];h.degreeOfMembership=h.computeDegreeOfMembership(a)}return this}};Ha.prototype.defuzzifyMaxAv=function(){for(var a=this.fuzzySets,
b=0,c=0,e=0,h=a.length;e<h;e++){var d=a[e];b+=d.degreeOfMembership;c+=d.representativeValue*d.degreeOfMembership}return 0===b?0:c/b};Ha.prototype.defuzzifyCentroid=function(a){a=void 0===a?10:a;for(var b=this.fuzzySets,c=(this.maxRange-this.minRange)/a,e=0,h=0,d=1;d<=a;d++)for(var z=this.minRange+d*c,l=0,f=b.length;l<f;l++){var g=b[l];g=Math.min(g.degreeOfMembership,g.computeDegreeOfMembership(z));e+=g;h+=z*g}return 0===e?0:h/e};Ha.prototype.toJSON=function(){for(var a={type:this.constructor.name,
fuzzySets:[],minRange:this.minRange.toString(),maxRange:this.maxRange.toString()},b=0,c=this.fuzzySets.length;b<c;b++)a.fuzzySets.push(this.fuzzySets[b].toJSON());return a};Ha.prototype.fromJSON=function(a){this.minRange=parseFloat(a.minRange);this.maxRange=parseFloat(a.maxRange);for(var b=0,c=a.fuzzySets.length;b<c;b++){var e=a.fuzzySets[b];switch(e.type){case "LeftShoulderFuzzySet":this.fuzzySets.push((new qb).fromJSON(e));break;case "RightShoulderFuzzySet":this.fuzzySets.push((new sb).fromJSON(e));
break;case "SingletonFuzzySet":this.fuzzySets.push((new tb).fromJSON(e));break;case "TriangularFuzzySet":this.fuzzySets.push((new ub).fromJSON(e));break;default:y.error("YUKA.FuzzyVariable: Unsupported fuzzy set type:",e.type)}}return this};var ha=function(){this.rules=[];this.flvs=new Map};ha.prototype.addFLV=function(a,b){this.flvs.set(a,b);return this};ha.prototype.removeFLV=function(a){this.flvs.delete(a);return this};ha.prototype.addRule=function(a){this.rules.push(a);return this};ha.prototype.removeRule=
function(a){var b=this.rules;a=b.indexOf(a);b.splice(a,1);return this};ha.prototype.fuzzify=function(a,b){this.flvs.get(a).fuzzify(b);return this};ha.prototype.defuzzify=function(a,b){b=void 0===b?ha.DEFUZ_TYPE.MAXAV:b;var c=this.flvs,e=this.rules;this._initConsequences();for(var h=0,d=e.length;h<d;h++)e[h].evaluate();a=c.get(a);switch(b){case ha.DEFUZ_TYPE.MAXAV:b=a.defuzzifyMaxAv();break;case ha.DEFUZ_TYPE.CENTROID:b=a.defuzzifyCentroid();break;default:y.warn("YUKA.FuzzyModule: Unknown defuzzification method:",
b),b=a.defuzzifyMaxAv()}return b};ha.prototype._initConsequences=function(){for(var a=this.rules,b=0,c=a.length;b<c;b++)a[b].initConsequence();return this};ha.prototype.toJSON=function(){for(var a={rules:[],flvs:[]},b=this.rules,c=0,e=b.length;c<e;c++)a.rules.push(b[c].toJSON());b=$jscomp.makeIterator(this.flvs);for(c=b.next();!c.done;c=b.next())e=$jscomp.makeIterator(c.value),c=e.next().value,e=e.next().value,a.flvs.push({name:c,flv:e.toJSON()});return a};ha.prototype.fromJSON=function(a){for(var b=
new Map,c=a.flvs,e=0,h=c.length;e<h;e++){var d=c[e],f=d.name;d=(new Ha).fromJSON(d.flv);this.addFLV(f,d);f=$jscomp.makeIterator(d.fuzzySets);for(d=f.next();!d.done;d=f.next())d=d.value,b.set(d.uuid,d)}a=a.rules;c=0;for(e=a.length;c<e;c++)h=a[c],h=(new vb).fromJSON(h,b),this.addRule(h);return this};ha.DEFUZ_TYPE=Object.freeze({MAXAV:0,CENTROID:1});var B=function(a){this.owner=void 0===a?null:a;this.status=B.STATUS.INACTIVE};B.prototype.activate=function(){};B.prototype.execute=function(){};B.prototype.terminate=
function(){};B.prototype.handleMessage=function(){return!1};B.prototype.active=function(){return this.status===B.STATUS.ACTIVE};B.prototype.inactive=function(){return this.status===B.STATUS.INACTIVE};B.prototype.completed=function(){return this.status===B.STATUS.COMPLETED};B.prototype.failed=function(){return this.status===B.STATUS.FAILED};B.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=B.STATUS.INACTIVE);return this};B.prototype.activateIfInactive=function(){!0===this.inactive()&&
(this.status=B.STATUS.ACTIVE,this.activate());return this};B.prototype.toJSON=function(){return{type:this.constructor.name,owner:this.owner.uuid,status:this.status}};B.prototype.fromJSON=function(a){this.owner=a.owner;this.status=a.status;return this};B.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;return this};B.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var ba=function(a){a=B.call(this,void 0===a?null:a)||this;a.subgoals=
[];return a};$jscomp.inherits(ba,B);ba.prototype.addSubgoal=function(a){this.subgoals.unshift(a);return this};ba.prototype.removeSubgoal=function(a){a=this.subgoals.indexOf(a);this.subgoals.splice(a,1);return this};ba.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};ba.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};ba.prototype.executeSubgoals=function(){for(var a=this.subgoals,
b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c instanceof ba&&c.clearSubgoals(),c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?B.STATUS.ACTIVE:b.status):B.STATUS.COMPLETED};ba.prototype.hasSubgoals=function(){return 0<this.subgoals.length};ba.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};ba.prototype.toJSON=function(){var a=
B.prototype.toJSON.call(this);a.subgoals=[];for(var b=0,c=this.subgoals.length;b<c;b++)a.subgoals.push(this.subgoals[b].toJSON());return a};ba.prototype.resolveReferences=function(a){B.prototype.resolveReferences.call(this,a);for(var b=0,c=this.subgoals.length;b<c;b++)this.subgoals[b].resolveReferences(a);return this};var Ob=function(a){this.characterBias=void 0===a?1:a};Ob.prototype.calculateDesirability=function(){return 0};Ob.prototype.setGoal=function(){};Ob.prototype.toJSON=function(){return{type:this.constructor.name,
characterBias:this.characterBias}};Ob.prototype.fromJSON=function(a){this.characterBias=a.characterBias;return this};var ua=function(a){a=ba.call(this,void 0===a?null:a)||this;a.evaluators=[];a._typesMap=new Map;return a};$jscomp.inherits(ua,ba);ua.prototype.activate=function(){this.arbitrate()};ua.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===B.STATUS.COMPLETED||a===B.STATUS.FAILED)this.status=B.STATUS.INACTIVE};ua.prototype.terminate=function(){this.clearSubgoals()};
ua.prototype.addEvaluator=function(a){this.evaluators.push(a);return this};ua.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,1);return this};ua.prototype.arbitrate=function(){for(var a=this.evaluators,b=-1,c=null,e=0,h=a.length;e<h;e++){var d=a[e],f=d.calculateDesirability(this.owner);f*=d.characterBias;f>=b&&(b=f,c=d)}null!==c?c.setGoal(this.owner):y.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};ua.prototype.toJSON=
function(){var a=ba.prototype.toJSON.call(this);a.evaluators=[];for(var b=0,c=this.evaluators.length;b<c;b++)a.evaluators.push(this.evaluators[b].toJSON());return a};ua.prototype.fromJSON=function(a){function b(a){var e=a.type,h=c.get(e);if(void 0!==h){e=(new h).fromJSON(a);a=a.subgoals;if(void 0!==a){h=0;for(var d=a.length;h<d;h++){var n=b(a[h]);n&&e.subgoals.push(n)}}return e}y.warn("YUKA.Think: Unsupported goal evaluator type:",e)}ba.prototype.fromJSON.call(this,a);var c=this._typesMap;this.evaluators.length=
0;this.terminate();for(var e=0,h=a.evaluators.length;e<h;e++){var d=a.evaluators[e],f=d.type,l=c.get(f);void 0!==l?(d=(new l).fromJSON(d),this.evaluators.push(d)):y.warn("YUKA.Think: Unsupported goal evaluator type:",f)}e=0;for(h=a.subgoals.length;e<h;e++)(d=b(a.subgoals[e]))&&this.subgoals.push(d);return this};ua.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var Aa=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};Aa.prototype.copy=
function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};Aa.prototype.clone=function(){return(new this.constructor).copy(this)};Aa.prototype.toJSON=function(){return{type:this.constructor.name,from:this.from,to:this.to,cost:this.cost}};Aa.prototype.fromJSON=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};var wb=function(a){this.index=void 0===a?-1:a};wb.prototype.toJSON=function(){return{type:this.constructor.name,index:this.index}};wb.prototype.fromJSON=function(a){this.index=
a.index;return this};var W=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};W.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};W.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};W.prototype.getNode=function(a){return this._nodes.get(a)||null};W.prototype.getEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=
this._edges.get(a);for(var c=0,e=a.length;c<e;c++){var h=a[c];if(h.to===b)return h}}return null};W.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return a};W.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return b};W.prototype.getNodeCount=function(){return this._nodes.size};W.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),
c=b.next();!c.done;c=b.next())a+=c.value.length;return a};W.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var e=c.length-1;0<=e;e--){var h=c[e];if(h.to===a.index){e=c.indexOf(h);c.splice(e,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())for(c=c.value,e=c.length-1;0<=e;e--)h=c[e],this.hasNode(h.to)&&
this.hasNode(h.from)||(h=c.indexOf(h),c.splice(h,1));this._edges.delete(a.index);return this};W.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var e=b.length;c<e;c++){var h=b[c];if(h.to===a.from){a=b.indexOf(h);b.splice(a,1);break}}}}return this};W.prototype.hasNode=function(a){return this._nodes.has(a)};W.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);
for(var c=0,e=a.length;c<e;c++)if(a[c].to===b)return!0}return!1};W.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};W.prototype.toJSON=function(){for(var a={type:this.constructor.name,digraph:this.digraph},b=[],c=[],e=$jscomp.makeIterator(this._nodes.entries()),h=e.next();!h.done;h=e.next()){h=$jscomp.makeIterator(h.value);var d=h.next().value;h=h.next().value;var f=[];this.getEdgesOfNode(d,f);d=0;for(var l=f.length;d<l;d++)b.push(f[d].toJSON());c.push(h.toJSON())}a._edges=
b;a._nodes=c;return a};W.prototype.fromJSON=function(a){this.digraph=a.digraph;for(var b=0,c=a._nodes.length;b<c;b++)this.addNode((new wb).fromJSON(a._nodes[b]));b=0;for(c=a._edges.length;b<c;b++)this.addEdge((new Aa).fromJSON(a._edges[b]));return this};var bd=function(){};bd.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var Zd=function(){};Zd.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};
var $d=function(){};$d.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var ae=function(){};ae.calculate=function(){return 0};var La=function(a){a=void 0===a?q:a;this.data=[];this.length=0;this.compare=a};La.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};La.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));
this.data.pop();return a};La.prototype.peek=function(){return this.data[0]||null};La.prototype._up=function(a){for(var b=this.data,c=this.compare,e=b[a];0<a;){var h=a-1>>1,d=b[h];if(0<=c(e,d))break;b[a]=d;a=h}b[a]=e};La.prototype._down=function(a){for(var b=this.data,c=this.compare,e=b[a],h=this.length>>1;a<h;){var d=(a<<1)+1,f=d+1,l=b[d];f<this.length&&0>c(b[f],l)&&(d=f,l=b[f]);if(0<=c(l,e))break;b[a]=l;a=d}b[a]=e};var xb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=
void 0===c?-1:c;this.found=!1;this.heuristic=bd;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};xb.prototype.search=function(){var a=[],b=new La(t);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var e=0,h=a.length;e<h;e++){var d=a[e],f=(this._cost.get(c)||
0)+d.cost,l=this.heuristic.calculate(this.graph,d.to,this.target);l=f+l;if(!1===this._searchFrontier.has(d.to)||f<this._cost.get(d.to))this._cost.set(d.to,f),this._searchFrontier.set(d.to,d),b.push({cost:l,index:d.to})}}}this.found=!1;return this};xb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};xb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
xb.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var Pb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Pb.prototype.search=function(){var a=[],b=[],c=new Aa(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var e=a.shift();this._route.set(e.to,
e.from);e!==c&&this._spanningTree.add(e);if(e.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=0;for(var h=b.length;e<h;e++){var d=b[e];!1===this._visited.has(d.to)&&(a.push(d),this._visited.add(d.to))}}this.found=!1;return this};Pb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Pb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};
Pb.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var Qb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Qb.prototype.search=function(){var a=[],b=[],c=new Aa(this.source,this.source);for(a.push(c);0<a.length;){var e=a.pop();this._route.set(e.to,e.from);this._visited.add(e.to);e!==c&&this._spanningTree.add(e);
if(e.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=0;for(var h=b.length;e<h;e++){var d=b[e];!1===this._visited.has(d.to)&&a.push(d)}}this.found=!1;return this};Qb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Qb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};Qb.prototype.clear=function(){this.found=
!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var Rb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};Rb.prototype.search=function(){var a=[],b=new La(m);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,
this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var e=0,h=a.length;e<h;e++){var d=a[e],f=(this._cost.get(c)||0)+d.cost;if(!1===this._searchFrontier.has(d.to)||f<this._cost.get(d.to))this._cost.set(d.to,f),this._searchFrontier.set(d.to,d),b.push({cost:f,index:d.to})}}}this.found=!1;return this};Rb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,
a.unshift(b);return a};Rb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};Rb.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var U=new f,yb=new f,zb=new f,Ae=new f(1,0,0),Be=new f(0,1,0),Ce=new f(0,0,1),Ma={a:new f,b:new f,c:new f},be=new f,Ab=[],cd=function(a,b,c){this.branchingFactor=void 0===a?2:a;this.primitivesPerNode=void 0===b?1:b;this.depth=void 0===
c?10:c;this.root=null};cd.prototype.fromMeshGeometry=function(a){this.root=new ka;a=a.toTriangleSoup().vertices;this.root.primitives.push.apply(this.root.primitives,$jscomp.arrayFromIterable(a));a=this.root.primitives;for(var b=0,c=a.length;b<c;b+=9)U.fromArray(a,b),yb.fromArray(a,b+3),zb.fromArray(a,b+6),U.add(yb).add(zb).divideScalar(3),this.root.centroids.push(U.x,U.y,U.z);this.root.build(this.branchingFactor,this.primitivesPerNode,this.depth,1);return this};cd.prototype.traverse=function(a){this.root.traverse(a);
return this};var ka=function(){this.parent=null;this.children=[];this.boundingVolume=new E;this.primitives=[];this.centroids=[]};ka.prototype.root=function(){return null===this.parent};ka.prototype.leaf=function(){return 0===this.children.length};ka.prototype.getDepth=function(){for(var a=0,b=this.parent;null!==b;)b=b.parent,a++;return a};ka.prototype.traverse=function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a);return this};ka.prototype.build=function(a,b,c,
e){this.computeBoundingVolume();var h=Math.floor(this.primitives.length/9/a);if(e<=c&&h>=b)for(this.split(a),h=0;h<a;h++)this.children[h].build(a,b,c,e+1);return this};ka.prototype.computeBoundingVolume=function(){var a=this.primitives,b=this.boundingVolume;b.min.set(Infinity,Infinity,Infinity);b.max.set(-Infinity,-Infinity,-Infinity);for(var c=0,e=a.length;c<e;c+=3)U.x=a[c],U.y=a[c+1],U.z=a[c+2],b.expand(U);return this};ka.prototype.computeSplitAxis=function(){for(var a,b,c=b=a=-Infinity,e,h,d=h=
e=Infinity,f=this.centroids,l=0,g=f.length;l<g;l+=3){var k=f[l],m=f[l+1],p=f[l+2];k>a&&(a=k);m>b&&(b=m);p>c&&(c=p);k<e&&(e=k);m<h&&(h=m);p<d&&(d=p)}a-=e;b-=h;c-=d;return a>b&&a>c?Ae:b>c?Be:Ce};ka.prototype.split=function(a){for(var b=this.centroids,c=this.primitives,e=0;e<a;e++)this.children[e]=new ka,this.children[e].parent=this;var h=this.computeSplitAxis();e=[];for(var d=0,f=b.length;d<f;d+=3){U.fromArray(b,d);var l=U.dot(h);e.push({index:d/3,p:l})}e.sort(xa);h=e.length;d=Math.floor(h/a);for(var g=
l=f=0;g<h;g++){l++;l>d&&f<a-1&&(l=1,f++);var k=this.children[f],m=e[g].index,p=9*m;U.fromArray(c,p);yb.fromArray(c,p+3);zb.fromArray(c,p+6);k.primitives.push(U.x,U.y,U.z);k.primitives.push(yb.x,yb.y,yb.z);k.primitives.push(zb.x,zb.y,zb.z);U.fromArray(b,3*m);k.centroids.push(U.x,U.y,U.z)}this.centroids.length=0;this.primitives.length=0;return this};ka.prototype.intersectRay=function(a,b){if(null!==a.intersectAABB(this.boundingVolume,b))if(!0===this.leaf())for(var c=this.primitives,e=0,h=c.length;e<
h;e+=9)Ma.a.fromArray(c,e),Ma.b.fromArray(c,e+3),Ma.c.fromArray(c,e+6),null!==a.intersectTriangle(Ma,!0,b)&&Ab.push(b.clone());else for(c=0,e=this.children.length;c<e;c++)this.children[c].intersectRay(a,b);if(!0===this.root()&&0<Ab.length){c=Infinity;e=0;for(h=Ab.length;e<h;e++){var d=a.origin.squaredDistanceTo(Ab[e]);d<c&&(c=d,b.copy(Ab[e]))}Ab.length=0;return b}return null};ka.prototype.intersectsRay=function(a){if(null!==a.intersectAABB(this.boundingVolume,be))if(!0===this.leaf())for(var b=this.primitives,
c=0,e=b.length;c<e;c+=9){if(Ma.a.fromArray(b,c),Ma.b.fromArray(b,c+3),Ma.c.fromArray(b,c+6),null!==a.intersectTriangle(Ma,!0,be))return!0}else for(b=0,c=this.children.length;b<c;b++)if(!0===this.children[b].intersectsRay(a))return!0;return!1};var ce=new f,rc=new f,la=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.from=a;this.to=b};la.prototype.set=function(a,b){this.from=a;this.to=b;return this};la.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);return this};la.prototype.clone=
function(){return(new this.constructor).copy(this)};la.prototype.delta=function(a){return a.subVectors(this.to,this.from)};la.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};la.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};la.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;ce.subVectors(a,this.from);rc.subVectors(this.to,this.from);a=rc.dot(rc);a=rc.dot(ce)/a;b&&(a=M.clamp(a,0,1));
return a};la.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var sc=new f,de=new f,dd=new f,ed=new f,fd=new f,gd=new f,ee=new f,Na=function(){};Na.prototype.intersects=function(a,b){return this._checkFaceDirections(a,b)||this._checkFaceDirections(b,a)||this._checkEdgeDirections(a,b)?!1:!0};Na.prototype._checkFaceDirections=function(a,b){a=a.faces;for(var c=0,e=a.length;c<e;c++){var h=a[c].plane;de.copy(h.normal).multiplyScalar(-1);var d=this._getSupportVertex(b,
de);if(0<h.distanceToPoint(d))return!0}return!1};Na.prototype._checkEdgeDirections=function(a,b){var c=a.edges;b=b.edges;for(var e=0,h=c.length;e<h;e++)for(var d=c[e],f=0,l=b.length;f<l;f++){var g=b[f];d.getDirection(dd);g.getDirection(ed);if(this._minkowskiFace(d,dd,g,ed)&&0<this._distanceBetweenEdges(d,dd,g,ed,a))return!0}return!1};Na.prototype._getSupportVertex=function(a,b){var c=-Infinity,e=null;a=a.vertices;for(var h=0,d=a.length;h<d;h++){var f=a[h],l=f.dot(b);l>c&&(c=l,e=f)}return e};Na.prototype._minkowskiFace=
function(a,b,c,e){var h=a.polygon.plane.normal;a=a.twin.polygon.plane.normal;fd.copy(c.polygon.plane.normal);gd.copy(c.twin.polygon.plane.normal);fd.multiplyScalar(-1);gd.multiplyScalar(-1);c=fd.dot(b);b=gd.dot(b);h=h.dot(e);e=a.dot(e);return 0>c*b&&0>h*e&&0<c*e};Na.prototype._distanceBetweenEdges=function(a,b,c,e,h){if(1===Math.abs(b.dot(e)))return-Infinity;sc.crossVectors(b,e).normalize();0>sc.dot(ee.subVectors(a.vertex,h.centroid))&&sc.multiplyScalar(-1);return sc.dot(ee.subVectors(c.vertex,a.vertex))};
var Oa=function(a){this.vertex=a=void 0===a?new f:a;this.polygon=this.twin=this.prev=this.next=null};Oa.prototype.tail=function(){return this.prev?this.prev.vertex:null};Oa.prototype.head=function(){return this.vertex};Oa.prototype.length=function(){var a=this.tail(),b=this.head();return null!==a?a.distanceTo(b):-1};Oa.prototype.squaredLength=function(){var a=this.tail(),b=this.head();return null!==a?a.squaredDistanceTo(b):-1};Oa.prototype.linkOpponent=function(a){this.twin=a;a.twin=this;return this};
Oa.prototype.getDirection=function(a){return a.subVectors(this.vertex,this.prev.vertex).normalize()};var V=function(){this.centroid=new f;this.edge=null;this.plane=new ea};V.prototype.fromContour=function(a){var b=[];if(3>a.length)return y.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var c=0,e=a.length;c<e;c++){var h=new Oa(a[c]);b.push(h)}c=0;for(e=b.length;c<e;c++){if(0===c){h=b[c];var d=b[e-1];var f=b[c+1]}else c===e-1?(h=b[c],d=b[c-1],
f=b[0]):(h=b[c],d=b[c-1],f=b[c+1]);h.prev=d;h.next=f;h.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],a[1],a[2]);return this};V.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;a.set(0,0,0);do a.add(b.vertex),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};V.prototype.contains=function(a,b){b=void 0===b?.001:b;var c=this.plane,e=this.edge;do{var h=e.tail(),d=e.head();if(!1===0<=M.area(h,d,a))return!1;e=e.next}while(e!==this.edge);a=c.distanceToPoint(a);
return Math.abs(a)>b?!1:!0};V.prototype.convex=function(a){a=void 0===a?!0:a;var b=this.edge;do{var c=b.tail(),e=b.head(),h=b.next.head();if(a){if(!1===0<=M.area(c,e,h))return!1}else if(!1===0<=M.area(h,e,c))return!1;b=b.next}while(b!==this.edge);return!0};V.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var e=b.distanceToPoint(c.vertex);if(Math.abs(e)>a)return!1;c=c.next}while(c!==this.edge);return!0};V.prototype.distanceToPoint=function(a){return this.plane.distanceToPoint(a)};
V.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==this.edge);return a};V.prototype.getEdgeTo=function(a){var b=this.edge;do{if(null!==b.twin&&b.twin.polygon===a)return b;b=b.next}while(b!==this.edge);return null};var Pa=function(){this.faces=[];this.edges=[];this.vertices=[];this.centroid=new f};Pa.prototype.computeCentroid=function(){var a=this.centroid,b=this.faces;a.set(0,0,0);for(var c=0,e=b.length;c<e;c++)a.add(b[c].centroid);a.divideScalar(b.length);
return this};Pa.prototype.computeUniqueVertices=function(){var a=this.faces,b=this.vertices;b.length=0;for(var c=new Set,e=0,h=a.length;e<h;e++){var d=a[e],f=d.edge;do c.add(f.vertex),f=f.next;while(f!==d.edge)}b.push.apply(b,$jscomp.arrayFromIterable(c));return this};Pa.prototype.computeUniqueEdges=function(){for(var a=this.faces,b=this.edges,c=b.length=0,e=a.length;c<e;c++){var h=a[c],d=h.edge;do!1===b.includes(d.twin)&&b.push(d),d=d.next;while(d!==h.edge)}return this};Pa.prototype.fromAABB=function(a){this.faces.length=
0;this.vertices.length=0;var b=a.min,c=a.max,e=[new f(c.x,c.y,c.z),new f(c.x,c.y,b.z),new f(c.x,b.y,c.z),new f(c.x,b.y,b.z),new f(b.x,c.y,c.z),new f(b.x,c.y,b.z),new f(b.x,b.y,c.z),new f(b.x,b.y,b.z)];this.vertices.push.apply(this.vertices,$jscomp.arrayFromIterable(e));b=(new V).fromContour([e[4],e[0],e[1],e[5]]);c=(new V).fromContour([e[2],e[3],e[1],e[0]]);var h=(new V).fromContour([e[6],e[2],e[0],e[4]]),d=(new V).fromContour([e[3],e[7],e[5],e[1]]),z=(new V).fromContour([e[3],e[2],e[6],e[7]]);e=
(new V).fromContour([e[7],e[6],e[4],e[5]]);b.edge.linkOpponent(e.edge.prev);b.edge.next.linkOpponent(h.edge.prev);b.edge.next.next.linkOpponent(c.edge.prev);b.edge.prev.linkOpponent(d.edge.prev);z.edge.linkOpponent(d.edge.next);z.edge.next.linkOpponent(c.edge.next);z.edge.next.next.linkOpponent(h.edge.next);z.edge.prev.linkOpponent(e.edge.next);e.edge.linkOpponent(d.edge.next.next);d.edge.linkOpponent(c.edge.next.next);c.edge.linkOpponent(h.edge.next.next);h.edge.linkOpponent(e.edge.next.next);this.faces.push(b,
c,h,d,z,e);b.computeCentroid();c.computeCentroid();h.computeCentroid();d.computeCentroid();z.computeCentroid();e.computeCentroid();a.getCenter(this.centroid);this.computeUniqueEdges();return this};var fe=new la,tc=new ea,ge=new f,De=new f(0,1,0),he=new Na,Sb,Q=function(){var a=Pa.call(this)||this;a._tolerance=-1;a._vertices=[];a._assigned=new pa;a._unassigned=new pa;a._newFaces=[];return a};$jscomp.inherits(Q,Pa);Q.prototype.containsPoint=function(a){for(var b=this.faces,c=0,e=b.length;c<e;c++)if(b[c].distanceToPoint(a)>
this._tolerance)return!1;return!0};Q.prototype.intersectsAABB=function(a){if(void 0===Sb)Sb=(new Pa).fromAABB(a);else{var b=a.min,c=a.max,e=Sb.vertices;e[0].set(c.x,c.y,c.z);e[1].set(c.x,c.y,b.z);e[2].set(c.x,b.y,c.z);e[3].set(c.x,b.y,b.z);e[4].set(b.x,c.y,c.z);e[5].set(b.x,c.y,b.z);e[6].set(b.x,b.y,c.z);e[7].set(b.x,b.y,b.z);a.getCenter(Sb.centroid)}return he.intersects(this,Sb)};Q.prototype.intersectsConvexHull=function(a){return he.intersects(this,a)};Q.prototype.fromPoints=function(a){if(4>a.length)return y.error("YUKA.ConvexHull: The given points array needs at least four points."),
this;for(var b=0,c=a.length;b<c;b++)this._vertices.push(new ie(a[b]));this._generate();return this};Q.prototype._addAdjoiningFace=function(a,b){a=new qa(a.point,b.prev.vertex,b.vertex);this.faces.push(a);a.getEdge(-1).linkOpponent(b.twin);return a.getEdge(0)};Q.prototype._addNewFaces=function(a,b){this._newFaces=[];for(var c=null,e=null,h=0,d=b.length;h<d;h++){var f=this._addAdjoiningFace(a,b[h]);null===c?c=f:f.next.linkOpponent(e);this._newFaces.push(f.polygon);e=f}c.next.linkOpponent(e);return this};
Q.prototype._addVertexToFace=function(a,b){a.face=b;null===b.outside?(this._assigned.append(a),b.outside=a):this._assigned.insertAfter(b.outside,a);return this};Q.prototype._addVertexToHull=function(a){var b=[];this._unassigned.clear();this._computeHorizon(a.point,null,a.face,b);this._addNewFaces(a,b);this._resolveUnassignedPoints(this._newFaces);return this};Q.prototype._reset=function(){this._vertices.length=0;this._assigned.clear();this._unassigned.clear();this._newFaces.length=0;return this};
Q.prototype._computeInitialHull=function(){var a=this._vertices;var b=this._computeExtremes();var c=b.min,e=b.max;var h=e.x.point.x-c.x.point.x;b=c.x;var d=e.x;var f=e.y.point.y-c.y.point.y;f>h&&(b=c.y,d=e.y,h=f);f=e.z.point.z-c.z.point.z;f>h&&(b=c.z,d=e.z);h=-Infinity;fe.set(b.point,d.point);c=0;for(e=a.length;c<e;c++){var l=a[c];if(l!==b&&l!==d&&(fe.closestPointToPoint(l.point,!0,ge),f=ge.squaredDistanceTo(l.point),f>h)){h=f;var g=l}}h=-Infinity;tc.fromCoplanarPoints(b.point,d.point,g.point);c=
0;for(e=a.length;c<e;c++)if(l=a[c],l!==b&&l!==d&&l!==g&&(f=Math.abs(tc.distanceToPoint(l.point)),f>h)){h=f;var k=l}if(0===tc.distanceToPoint(k.point))throw"ERROR: YUKA.ConvexHull: All extreme points lie in a single plane. Unable to compute convex hull.";c=this.faces;0>tc.distanceToPoint(k.point)?(c.push(new qa(b.point,d.point,g.point),new qa(k.point,d.point,b.point),new qa(k.point,g.point,d.point),new qa(k.point,b.point,g.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(1)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),
c[3].getEdge(2).linkOpponent(c[0].getEdge(0)),c[1].getEdge(1).linkOpponent(c[2].getEdge(0)),c[2].getEdge(1).linkOpponent(c[3].getEdge(0)),c[3].getEdge(1).linkOpponent(c[1].getEdge(0))):(c.push(new qa(b.point,g.point,d.point),new qa(k.point,b.point,d.point),new qa(k.point,d.point,g.point),new qa(k.point,g.point,b.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(0)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),c[3].getEdge(2).linkOpponent(c[0].getEdge(1)),c[1].getEdge(0).linkOpponent(c[2].getEdge(1)),
c[2].getEdge(0).linkOpponent(c[3].getEdge(1)),c[3].getEdge(0).linkOpponent(c[1].getEdge(1)));e=0;for(l=a.length;e<l;e++){var m=a[e];if(m!==b&&m!==d&&m!==g&&m!==k){h=this._tolerance;for(var p=null,q=0;4>q;q++)f=c[q].distanceToPoint(m.point),f>h&&(h=f,p=c[q]);null!==p&&this._addVertexToFace(m,p)}}return this};Q.prototype._computeExtremes=function(){for(var a=new f(Infinity,Infinity,Infinity),b=new f(-Infinity,-Infinity,-Infinity),c={x:null,y:null,z:null},e={x:null,y:null,z:null},h=0,d=this._vertices.length;h<
d;h++){var g=this._vertices[h],l=g.point;l.x<a.x&&(a.x=l.x,c.x=g);l.y<a.y&&(a.y=l.y,c.y=g);l.z<a.z&&(a.z=l.z,c.z=g);l.x>b.x&&(b.x=l.x,e.x=g);l.y>b.y&&(b.y=l.y,e.y=g);l.z>b.z&&(b.z=l.z,e.z=g)}this._tolerance=3*Number.EPSILON*(Math.max(Math.abs(a.x),Math.abs(b.x))+Math.max(Math.abs(a.y),Math.abs(b.y))+Math.max(Math.abs(a.z),Math.abs(b.z)));return{min:c,max:e}};Q.prototype._computeHorizon=function(a,b,c,e){if(c.outside){var h=c.outside;this._removeAllVerticesFromFace(c);this._unassigned.appendChain(h)}c.active=
!1;c=null===b?b=c.getEdge(0):b.next;do{h=c.twin;var d=h.polygon;d.active&&(d.distanceToPoint(a)>this._tolerance?this._computeHorizon(a,h,d,e):e.push(c));c=c.next}while(c!==b);return this};Q.prototype._generate=function(){this.faces.length=0;this._computeInitialHull();for(var a;a=this._nextVertexToAdd();)this._addVertexToHull(a);this._updateFaces();this._mergeFaces();this._reset();return this};Q.prototype._mergeFaces=function(){var a=this.faces,b=this.edges;this.computeUniqueEdges();b.sort(function(a,
b){return b.length()-a.length()});for(var c=0,e=b.length;c<e;c++){var h=b[c],d=h;var f=d.prev;var l=d.next;var g=d.twin.prev;var k=d.twin.next;d.prev.next=d.twin.next;d.next.prev=d.twin.prev;d.twin.prev.next=d.next;d.twin.next.prev=d.prev;var m=d.polygon;m.edge=d.prev;var p=0<=m.plane.normal.dot(De);if(!0===m.convex(p)&&!0===m.coplanar(this._tolerance)){f=m.edge;do f.polygon=m,f=f.next;while(f!==m.edge);h=a.indexOf(h.twin.polygon);a.splice(h,1)}else f.next=d,l.prev=d,g.next=d.twin,k.prev=d.twin,m.edge=
d}b=0;for(c=a.length;b<c;b++)a[b].computeCentroid();this.computeCentroid();this.computeUniqueEdges();this.computeUniqueVertices();return this};Q.prototype._nextVertexToAdd=function(){var a=null;if(!1===this._assigned.empty()){var b=0,c=this._assigned.first(),e=c.face;do{var d=e.distanceToPoint(c.point);d>b&&(b=d,a=c);c=c.next}while(null!==c&&c.face===e)}return a};Q.prototype._updateFaces=function(){for(var a=this.faces,b=[],c=0,e=a.length;c<e;c++){var d=a[c];d.active&&b.push(d)}this.faces.length=
0;this.faces.push.apply(this.faces,$jscomp.arrayFromIterable(b));return this};Q.prototype._removeAllVerticesFromFace=function(a){if(null!==a.outside){var b=a.outside;b.face=null;for(var c=a.outside;null!==c.next&&c.next.face===a;)c=c.next,c.face=null;a.outside=null;this._assigned.removeChain(b,c)}return this};Q.prototype._removeVertexFromFace=function(a,b){a.face=null;a===b.outside&&(b.outside=null!==a.next&&a.next.face===b?a.next:null);this._assigned.remove(a);return this};Q.prototype._resolveUnassignedPoints=
function(a){if(!1===this._unassigned.empty()){var b=this._unassigned.first();do{for(var c=b.next,e=this._tolerance,d=null,f=0,g=a.length;f<g;f++){var l=a[f];if(l.active){var k=l.distanceToPoint(b.point);k>e&&(e=k,d=l)}}null!==d&&this._addVertexToFace(b,d);b=c}while(null!==b)}return this};var qa=function(a,b,c){a=void 0===a?new f:a;b=void 0===b?new f:b;c=void 0===c?new f:c;var e=V.call(this)||this;e.outside=null;e.active=!0;e.fromContour([a,b,c]);e.computeCentroid();return e};$jscomp.inherits(qa,V);
qa.prototype.getEdge=function(a){for(var b=this.edge;0<a;)b=b.next,a--;for(;0>a;)b=b.prev,a++;return b};var ie=function(a){this.point=a=void 0===a?new f:a;this.face=this.next=this.prev=null},pa=function(){this.tail=this.head=null};pa.prototype.first=function(){return this.head};pa.prototype.last=function(){return this.tail};pa.prototype.clear=function(){this.head=this.tail=null;return this};pa.prototype.insertAfter=function(a,b){b.prev=a;b.next=a.next;b.next?b.next.prev=b:this.tail=b;a.next=b;return this};
pa.prototype.append=function(a){null===this.head?this.head=a:this.tail.next=a;a.prev=this.tail;a.next=null;this.tail=a;return this};pa.prototype.appendChain=function(a){null===this.head?this.head=a:this.tail.next=a;for(a.prev=this.tail;null!==a.next;)a=a.next;this.tail=a;return this};pa.prototype.remove=function(a){null===a.prev?this.head=a.next:a.prev.next=a.next;null===a.next?this.tail=a.prev:a.next.prev=a.prev;a.prev=null;a.next=null;return this};pa.prototype.removeChain=function(a,b){null===a.prev?
this.head=b.next:a.prev.next=b.next;null===b.next?this.tail=a.prev:b.next.prev=a.prev;a.prev=null;b.next=null;return this};pa.prototype.empty=function(){return null===this.head};var je={unitary:new C,diagonal:new C},ke=null,ab=[new f,new f,new f],H=[],le=null,uc=[new f,new f,new f],I=[],N=[[],[],[]],u=[[],[],[]],J=[],bb=new f,cb=new f,db=new f,ra=new f,me=new f,Z=function(a,b,c){a=void 0===a?new f:a;b=void 0===b?new f:b;c=void 0===c?new C:c;this.center=a;this.halfSizes=b;this.rotation=c};Z.prototype.set=
function(a,b,c){this.center=a;this.halfSizes=b;this.rotation=c;return this};Z.prototype.copy=function(a){this.center.copy(a.center);this.halfSizes.copy(a.halfSizes);this.rotation.copy(a.rotation);return this};Z.prototype.clone=function(){return(new this.constructor).copy(this)};Z.prototype.getSize=function(a){return a.copy(this.halfSizes).multiplyScalar(2)};Z.prototype.clampPoint=function(a,b){var c=this.halfSizes;ra.subVectors(a,this.center);this.rotation.extractBasis(bb,cb,db);b.copy(this.center);
a=M.clamp(ra.dot(bb),-c.x,c.x);b.add(bb.multiplyScalar(a));a=M.clamp(ra.dot(cb),-c.y,c.y);b.add(cb.multiplyScalar(a));c=M.clamp(ra.dot(db),-c.z,c.z);b.add(db.multiplyScalar(c));return b};Z.prototype.containsPoint=function(a){ra.subVectors(a,this.center);this.rotation.extractBasis(bb,cb,db);return Math.abs(ra.dot(bb))<=this.halfSizes.x&&Math.abs(ra.dot(cb))<=this.halfSizes.y&&Math.abs(ra.dot(db))<=this.halfSizes.z};Z.prototype.intersectsAABB=function(a){return this.intersectsOBB(Ee.fromAABB(a))};Z.prototype.intersectsBoundingSphere=
function(a){this.clampPoint(a.center,me);return me.squaredDistanceTo(a.center)<=a.radius*a.radius};Z.prototype.intersectsOBB=function(a,b){b=void 0===b?Number.EPSILON:b;ke=this.center;H[0]=this.halfSizes.x;H[1]=this.halfSizes.y;H[2]=this.halfSizes.z;this.rotation.extractBasis(ab[0],ab[1],ab[2]);le=a.center;I[0]=a.halfSizes.x;I[1]=a.halfSizes.y;I[2]=a.halfSizes.z;a.rotation.extractBasis(uc[0],uc[1],uc[2]);for(a=0;3>a;a++)for(var c=0;3>c;c++)N[a][c]=ab[a].dot(uc[c]);ra.subVectors(le,ke);J[0]=ra.dot(ab[0]);
J[1]=ra.dot(ab[1]);J[2]=ra.dot(ab[2]);for(a=0;3>a;a++)for(c=0;3>c;c++)u[a][c]=Math.abs(N[a][c])+b;for(c=0;3>c;c++)if(b=H[c],a=I[0]*u[c][0]+I[1]*u[c][1]+I[2]*u[c][2],Math.abs(J[c])>b+a)return!1;for(c=0;3>c;c++)if(b=H[0]*u[0][c]+H[1]*u[1][c]+H[2]*u[2][c],a=I[c],Math.abs(J[0]*N[0][c]+J[1]*N[1][c]+J[2]*N[2][c])>b+a)return!1;b=H[1]*u[2][0]+H[2]*u[1][0];a=I[1]*u[0][2]+I[2]*u[0][1];if(Math.abs(J[2]*N[1][0]-J[1]*N[2][0])>b+a)return!1;b=H[1]*u[2][1]+H[2]*u[1][1];a=I[0]*u[0][2]+I[2]*u[0][0];if(Math.abs(J[2]*
N[1][1]-J[1]*N[2][1])>b+a)return!1;b=H[1]*u[2][2]+H[2]*u[1][2];a=I[0]*u[0][1]+I[1]*u[0][0];if(Math.abs(J[2]*N[1][2]-J[1]*N[2][2])>b+a)return!1;b=H[0]*u[2][0]+H[2]*u[0][0];a=I[1]*u[1][2]+I[2]*u[1][1];if(Math.abs(J[0]*N[2][0]-J[2]*N[0][0])>b+a)return!1;b=H[0]*u[2][1]+H[2]*u[0][1];a=I[0]*u[1][2]+I[2]*u[1][0];if(Math.abs(J[0]*N[2][1]-J[2]*N[0][1])>b+a)return!1;b=H[0]*u[2][2]+H[2]*u[0][2];a=I[0]*u[1][1]+I[1]*u[1][0];if(Math.abs(J[0]*N[2][2]-J[2]*N[0][2])>b+a)return!1;b=H[0]*u[1][0]+H[1]*u[0][0];a=I[1]*
u[2][2]+I[2]*u[2][1];if(Math.abs(J[1]*N[0][0]-J[0]*N[1][0])>b+a)return!1;b=H[0]*u[1][1]+H[1]*u[0][1];a=I[0]*u[2][2]+I[2]*u[2][0];if(Math.abs(J[1]*N[0][1]-J[0]*N[1][1])>b+a)return!1;b=H[0]*u[1][2]+H[1]*u[0][2];a=I[0]*u[2][1]+I[1]*u[2][0];return Math.abs(J[1]*N[0][2]-J[0]*N[1][2])>b+a?!1:!0};Z.prototype.intersectsPlane=function(a){this.rotation.extractBasis(bb,cb,db);var b=this.halfSizes.x*Math.abs(a.normal.dot(bb))+this.halfSizes.y*Math.abs(a.normal.dot(cb))+this.halfSizes.z*Math.abs(a.normal.dot(db));
a=a.normal.dot(this.center)-a.constant;return Math.abs(a)<=b};Z.prototype.fromAABB=function(a){a.getCenter(this.center);a.getSize(this.halfSizes).multiplyScalar(.5);this.rotation.identity();return this};Z.prototype.fromPoints=function(a){for(var b=(new Q).fromPoints(a).faces,c=[],e=[],d=0,n=b.length;d<n;d++){var g=b[d],l=g.edge;c.length=0;do c.push(l),l=l.next;while(l!==g.edge);g=1;for(l=c.length-2;g<=l;g++){var k=c[0].vertex,m=c[g+0].vertex,p=c[g+1].vertex;e.push(k.x,k.y,k.z);e.push(m.x,m.y,m.z);
e.push(p.x,p.y,p.z)}}k=new f;m=new f;p=new f;for(var q=new f,r=new f,u=new f,t=new f,v=new f,w=0,x=b=c=d=n=g=l=0,A=e.length;x<A;x+=9){k.fromArray(e,x);m.fromArray(e,x+3);p.fromArray(e,x+6);t.set(0,0,0);t.add(k).add(m).add(p).divideScalar(3);q.subVectors(m,k);r.subVectors(p,k);var y=u.crossVectors(q,r).length()/2;v.add(u.copy(t).multiplyScalar(y));w+=y;b+=y/12*(9*t.x*t.x+k.x*k.x+m.x*m.x+p.x*p.x);c+=y/12*(9*t.x*t.y+k.x*k.y+m.x*m.y+p.x*p.y);d+=y/12*(9*t.x*t.z+k.x*k.z+m.x*m.z+p.x*p.z);n+=y/12*(9*t.y*
t.y+k.y*k.y+m.y*m.y+p.y*p.y);g+=y/12*(9*t.y*t.z+k.y*k.z+m.y*m.z+p.y*p.z);l+=y/12*(9*t.z*t.z+k.z*k.z+m.z*m.z+p.z*p.z)}v.divideScalar(w);b=b/w-v.x*v.x;c=c/w-v.x*v.y;d=d/w-v.x*v.z;n=n/w-v.y*v.y;g=g/w-v.y*v.z;l=l/w-v.z*v.z;e=new C;e.elements[0]=b;e.elements[1]=c;e.elements[2]=d;e.elements[3]=c;e.elements[4]=n;e.elements[5]=g;e.elements[6]=d;e.elements[7]=g;e.elements[8]=l;e.eigenDecomposition(je);e=je.unitary;b=new f;c=new f;d=new f;e.extractBasis(b,c,d);l=g=n=-Infinity;p=m=k=Infinity;q=0;for(r=a.length;q<
r;q++)u=a[q],n=Math.max(b.dot(u),n),g=Math.max(c.dot(u),g),l=Math.max(d.dot(u),l),k=Math.min(b.dot(u),k),m=Math.min(c.dot(u),m),p=Math.min(d.dot(u),p);b.multiplyScalar(.5*(k+n));c.multiplyScalar(.5*(m+g));d.multiplyScalar(.5*(p+l));this.center.add(b).add(c).add(d);this.halfSizes.x=n-k;this.halfSizes.y=g-m;this.halfSizes.z=l-p;this.halfSizes.multiplyScalar(.5);this.rotation.copy(e);return this};Z.prototype.equals=function(a){return a.center.equals(this.center)&&a.halfSizes.equals(this.halfSizes)&&
a.rotation.equals(this.rotation)};Z.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),halfSizes:this.halfSizes.toArray([]),rotation:this.rotation.toArray([])}};Z.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.halfSizes.fromArray(a.halfSizes);this.rotation.fromArray(a.rotation);return this};var Ee=new Z,vc=function(a,b,c){return Aa.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(vc,Aa);var wc=function(a,
b,c){a=void 0===a?-1:a;b=void 0===b?new f:b;c=void 0===c?{}:c;a=wb.call(this,a)||this;a.position=b;a.userData=c;return a};$jscomp.inherits(wc,wb);var ne=function(){};ne.createGridLayout=function(a,b){var c=new W;c.digraph=!0;var e=a/2;a/=b;for(var d=0,n=0;n<=b;n++)for(var g=n*a-e,l=0;l<=b;l++){var k=new f(l*a-e,0,g);k=new wc(d,k);c.addNode(k);d++}b=c.getNodeCount();e=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(d=c.getNode(a),n=0;n<b;n++)a!==n&&(g=c.getNode(n).position.squaredDistanceTo(d.position),g<=e&&
(g=new vc(a,n,Math.sqrt(g)),c.addEdge(g)));return c};var xc=function(){this.portalEdges=[]};xc.prototype.push=function(a,b){this.portalEdges.push({left:a,right:b});return this};xc.prototype.generate=function(){var a=this.portalEdges,b=[],c=0,e=0;var d=a[0].left;var f=a[0].left;var g=a[0].right;b.push(d);var l=1;for(var k=a.length;l<k;l++){var m=a[l].left,p=a[l].right;if(0>=M.area(d,g,p))if(d===g||0<M.area(d,f,p))g=p,e=l;else{b.push(f);d=f;l=c;g=f=d;e=c=l;continue}0<=M.area(d,f,m)&&(d===f||0>M.area(d,
g,m)?(f=m,c=l):(b.push(g),d=g,l=e,g=f=d,e=c=l))}0!==b.length&&b[b.length-1]===a[a.length-1].left||b.push(a[a.length-1].left);return b};var Qa=function(){this._nodeMap=new Map};Qa.prototype.init=function(a){var b=a.graph,c=[];this.clear();b.getNodes(c);b=0;for(var e=c.length;b<e;b++)for(var d=c[b],f=0,g=c.length;f<g;f++){for(var l=c[f],k=a.findPath(d.position,l.position),m=0,p=0,q=k.length-1;p<q;p++)m+=k[p].distanceTo(k[p+1]);this.set(d.index,l.index,m)}return this};Qa.prototype.clear=function(){this._nodeMap.clear();
return this};Qa.prototype.set=function(a,b,c){var e=this._nodeMap;!1===e.has(a)&&e.set(a,new Map);e.get(a).set(b,c);return this};Qa.prototype.get=function(a,b){return this._nodeMap.get(a).get(b)};Qa.prototype.size=function(){return this._nodeMap.size};Qa.prototype.toJSON=function(){for(var a={nodes:[]},b=$jscomp.makeIterator(this._nodeMap.entries()),c=b.next();!c.done;c=b.next()){var e=$jscomp.makeIterator(c.value);c=e.next().value;e=e.next().value;a.nodes.push({index:c,costs:Array.from(e)})}return a};
Qa.prototype.fromJSON=function(a){a=a.nodes;for(var b=0,c=a.length;b<c;b++){var e=a[b],d=e.index;e=new Map(e.costs);this._nodeMap.set(d,e)}return this};var hd=new f,id=new f,jd=new f,Tb=new f,Ub=new la,kd=[],ld={edge:null,closestPoint:new f},da=function(){this.graph=new W;this.attemptBuildGraph=this.attemptMergePolies=this.graph.digraph=!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=1;this._borderEdges=[]};da.prototype.fromPolygons=function(a){this.clear();
for(var b=[],c=[],e=0,d=a.length;e<d;e++){var f=a[e],g=f.edge;do b.push(g),g=g.next;while(g!==f.edge);this.regions.push(f)}a=0;for(e=b.length;a<e;a++)if(d=b[a],null===d.twin)for(f=a+1,g=b.length;f<g;f++){var l=b[f];if(d.tail().equals(l.head())&&d.head().equals(l.tail())){d.linkOpponent(l);f=d.squaredLength();c.push({cost:f,edge:d});break}}c.sort(F);this._buildRegions(c);this.attemptBuildGraph&&this._buildGraph();return this};da.prototype.clear=function(){this.graph.clear();this.regions.length=0;this.spatialIndex=
null;return this};da.prototype.getClosestRegion=function(a){for(var b=this.regions,c=null,e=Infinity,d=0,f=b.length;d<f;d++){var g=b[d],l=a.squaredDistanceTo(g.centroid);l<e&&(e=l,c=g)}return c};da.prototype.getRandomRegion=function(){var a=this.regions,b=Math.floor(Math.random()*a.length);b===a.length&&(b=a.length-1);return a[b]};da.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=this.spatialIndex.getIndexForPosition(a);c=this.spatialIndex.cells[c];
if(!c)return null;c=c.entries}else c=this.regions;for(var e=0,d=c.length;e<d;e++){var f=c[e];if(!0===f.contains(a,b))return f}return null};da.prototype.getNodeIndex=function(a){return this.regions.indexOf(a)};da.prototype.findPath=function(a,b){var c=this.graph,e=[],d=this.getRegionForPoint(a,this.epsilonContainsTest),n=this.getRegionForPoint(b,this.epsilonContainsTest);if(null===d||null===n)null===d&&(d=this.getClosestRegion(a)),null===n&&(n=this.getClosestRegion(b));if(d===n)e.push((new f).copy(a)),
e.push((new f).copy(b));else if(d=this.getNodeIndex(d),n=this.getNodeIndex(n),c=new xb(c,d,n),c.search(),!0===c.found){c=c.getPath();n=new xc;n.push(a,a);a={left:null,right:null};d=0;for(var g=c.length-1;d<g;d++)this._getPortalEdge(this.regions[c[d]],this.regions[c[d+1]],a),n.push(a.left,a.right);n.push(b,b);e.push.apply(e,$jscomp.arrayFromIterable(n.generate()))}return e};da.prototype.clampMovement=function(a,b,c,e){var d=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===d){if(null===
a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");this._getClosestBorderEdge(b,ld);d=ld.edge;var f=ld.closestPoint;d.getDirection(id);c=jd.subVectors(c,b).length();var g=0;0!==c&&(jd.divideScalar(c),g=id.dot(jd));Tb.copy(f).add(id.multiplyScalar(g*c));Ub.set(d.prev.vertex,d.vertex);d=Ub.closestPointToPointParameter(Tb,!1);if(0<=d&&1>=d)e.copy(Tb);else{d=this.getRegionForPoint(Tb,this.epsilonContainsTest);if(null!==d)return e.copy(Tb),d;e.copy(b)}return a}return d};da.prototype.updateSpatialIndex=
function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};da.prototype._buildRegions=function(a){for(var b=this.regions,c,e,d,f,g=0,l=a.length;g<l;g++){var k=a[g],m=k.edge;c=m.prev;e=m.next;d=m.twin.prev;f=m.twin.next;m.prev.next=m.twin.next;m.next.prev=m.twin.prev;m.twin.prev.next=m.next;m.twin.next.prev=m.prev;var p=m.polygon;p.edge=m.prev;if(this.attemptMergePolies&&!0===p.convex()&&!0===p.coplanar(this.epsilonCoplanarTest)){c=
p.edge;do c.polygon=p,c=c.next;while(c!==p.edge);k=b.indexOf(k.edge.twin.polygon);b.splice(k,1)}else c.next=m,e.prev=m,d.next=m.twin,f.prev=m.twin,p.edge=m}a=0;for(g=b.length;a<g;a++){l=b[a];l.computeCentroid();k=l.edge;do null===k.twin&&this._borderEdges.push(k),k=k.next;while(k!==l.edge)}};da.prototype._buildGraph=function(){for(var a=this.graph,b=this.regions,c=[],e=0,d=b.length;e<d;e++){var f=b[e],g=[];c.push(g);var l=f.edge;do{if(null!==l.twin){var k=this.getNodeIndex(l.twin.polygon);g.push(k);
!1===a.hasNode(this.getNodeIndex(l.polygon))&&(k=new wc(this.getNodeIndex(l.polygon),l.polygon.centroid),a.addNode(k))}l=l.next}while(l!==f.edge)}b=0;for(e=c.length;b<e;b++)for(d=c[b],f=b,g=0,l=d.length;g<l;g++)if(k=d[g],f!==k&&!1===a.hasEdge(f,k)){var m=a.getNode(f),p=a.getNode(k);m=m.position.distanceTo(p.position);a.addEdge(new vc(f,k,m))}return this};da.prototype._getClosestBorderEdge=function(a,b){var c=Infinity;if(null!==this.spatialIndex){kd.length=0;var e=this.spatialIndex.getIndexForPosition(a);
e=this.spatialIndex.cells[e].entries;for(var d=0,f=e.length;d<f;d++){var g=e[d],l=g.edge;do null===l.twin&&kd.push(l),l=l.next;while(l!==g.edge)}e=kd}else e=this._borderEdges;d=0;for(f=e.length;d<f;d++)g=e[d],Ub.set(g.prev.vertex,g.vertex),l=Ub.closestPointToPointParameter(a),Ub.at(l,hd),l=hd.squaredDistanceTo(a),l<c&&(c=l,b.edge=g,b.closestPoint.copy(hd));return this};da.prototype._getPortalEdge=function(a,b,c){var e=a.edge;do{if(null!==e.twin&&e.twin.polygon===b)return c.left=e.prev.vertex,c.right=
e.vertex,c;e=e.next}while(e!==a.edge);c.left=null;c.right=null;return c};var oe=function(){};oe.prototype.load=function(a,b){return new Promise(function(c,e){fetch(a).then(function(a){if(200<=a.status&&300>a.status)return a.arrayBuffer();var b=Error(a.statusText||a.status);b.response=a;return Promise.reject(b)}).then(function(c){var e=new Ba,d=new TextDecoder;"glTF"===d.decode(new Uint8Array(c,0,4))?(e.parseBinary(c),c=e.extensions.get("BINARY").content):c=d.decode(new Uint8Array(c));c=JSON.parse(c);
if(void 0===c.asset||2>c.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");d=a.lastIndexOf("/");d=-1===d?"./":a.substr(0,d+1);return e.parse(c,d,b)}).then(function(a){c(a)}).catch(function(a){y.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",a);e(a)})})};var Ba=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};Ba.prototype.parse=function(a,b,c){var e=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=
e.parseGeometry(a);var b=new da;c&&c.epsilonCoplanarTest&&(b.epsilonCoplanarTest=c.epsilonCoplanarTest);return b.fromPolygons(a)})};Ba.prototype.parseGeometry=function(a){var b=a.index,c=a.position;a=[];for(var e=[],d=0,g=c.length;d<g;d+=3){var k=new f;k.x=c[d+0];k.y=c[d+1];k.z=c[d+2];a.push(k)}if(b)for(c=0,d=b.length;c<d;c+=3)g=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],g=(new V).fromContour(g),e.push(g);else for(b=0,c=a.length;b<c;b+=3)d=[a[b+0],a[b+1],a[b+2]],d=(new V).fromContour(d),e.push(d);return e};
Ba.prototype.getDependencies=function(a){var b=this,c=this.cache,e=c.get(a);e||(e=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,e){return b.getDependency(a,e)})),c.set(a,e));return e};Ba.prototype.getDependency=function(a,b){var c=this.cache,e=a+":"+b,d=c.get(e);if(void 0===d){switch(a){case "accessor":d=this.loadAccessor(b);break;case "buffer":d=this.loadBuffer(b);break;case "bufferView":d=this.loadBufferView(b);break;case "mesh":d=this.loadMesh(b);break;default:throw Error("Unknown type: "+
a);}c.set(e,d)}return d};Ba.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var e=Db(c.uri,b.path);fetch(e).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){y.error("YUKA.NavMeshLoader: Unable to load buffer.",a);d(a)})})};Ba.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=
b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};Ba.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new Fe[b.componentType](a,b.byteOffset||0,b.count*Ge[b.type])})};Ba.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=b.primitives[0];if(void 0!==c.mode&&4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");
return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};Ba.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,e=new TextDecoder,d=null,f=null;c<b.byteLength;){var g=b.getUint32(c,!0);c+=4;var l=b.getUint32(c,!0);c+=4;l===pe.JSON?(d=new Uint8Array(a,12+c,g),d=e.decode(d)):l===pe.BIN&&(f=12+c,f=a.slice(f,f+g));c+=g}this.extensions.set("BINARY",{content:d,body:f})};var Ge={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fe={5120:Int8Array,5121:Uint8Array,
5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pe={JSON:1313821514,BIN:5130562},va=function(a){this.aabb=a=void 0===a?new E:a;this.entries=[]};va.prototype.add=function(a){this.entries.push(a);return this};va.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};va.prototype.makeEmpty=function(){this.entries.length=0;return this};va.prototype.empty=function(){return 0===this.entries.length};va.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};
va.prototype.toJSON=function(){for(var a={type:this.constructor.name,aabb:this.aabb.toJSON(),entries:[]},b=this.entries,c=0,e=b.length;c<e;c++)a.entries.push(b[c].uuid);return a};va.prototype.fromJSON=function(a){this.aabb.fromJSON(a.aabb);this.entries=a.entries.slice();return this};va.prototype.resolveReferences=function(a){for(var b=this.entries,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c]);return this};var yc=new f,Vb=new E,qe=[],wa=function(a,b,c,e,d,g){this.cells=[];this.width=a;this.height=b;this.depth=
c;this.cellsX=e;this.cellsY=d;this.cellsZ=g;this._halfWidth=this.width/2;this._halfHeight=this.height/2;this._halfDepth=this.depth/2;this._min=new f(-this._halfWidth,-this._halfHeight,-this._halfDepth);this._max=new f(this._halfWidth,this._halfHeight,this._halfDepth);a=this.width/this.cellsX;b=this.height/this.cellsY;c=this.depth/this.cellsZ;for(e=0;e<this.cellsX;e++)for(d=e*a-this._halfWidth,g=0;g<this.cellsY;g++)for(var h=g*b-this._halfHeight,l=0;l<this.cellsZ;l++){var n=l*c-this._halfDepth,k=new f,
m=new f;k.set(d,h,n);m.x=k.x+a;m.y=k.y+b;m.z=k.z+c;n=new E(k,m);n=new va(n);this.cells.push(n)}};wa.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};wa.prototype.addEntityToPartition=function(a,b){this.cells[b].add(a);return this};wa.prototype.removeEntityFromPartition=function(a,b){this.cells[b].remove(a);return this};wa.prototype.getIndexForPosition=function(a){yc.copy(a).clamp(this._min,
this._max);a=Math.abs(Math.floor(this.cellsX*(yc.x+this._halfWidth)/this.width));var b=Math.abs(Math.floor(this.cellsY*(yc.y+this._halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(yc.z+this._halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};wa.prototype.query=function(a,b,c){var e=this.cells;c.length=0;Vb.min.copy(a).subScalar(b);Vb.max.copy(a).addScalar(b);
a=0;for(b=e.length;a<b;a++){var d=e[a];!1===d.empty()&&!0===d.intersects(Vb)&&c.push.apply(c,$jscomp.arrayFromIterable(d.entries))}return c};wa.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};wa.prototype.addPolygon=function(a){var b=this.cells;a.getContour(qe);Vb.fromPoints(qe);for(var c=0,e=b.length;c<e;c++){var d=b[c];!0===d.intersects(Vb)&&d.add(a)}return this};wa.prototype.toJSON=function(){for(var a={type:this.constructor.name,cells:[],
width:this.width,height:this.height,depth:this.depth,cellsX:this.cellsX,cellsY:this.cellsY,cellsZ:this.cellsZ,_halfWidth:this._halfWidth,_halfHeight:this._halfHeight,_halfDepth:this._halfDepth,_min:this._min.toArray([]),_max:this._max.toArray([])},b=0,c=this.cells.length;b<c;b++)a.cells.push(this.cells[b].toJSON());return a};wa.prototype.fromJSON=function(a){this.cells.length=0;this.width=a.width;this.height=a.height;this.depth=a.depth;this.cellsX=a.cellsX;this.cellsY=a.cellsY;this.cellsZ=a.cellsZ;
this._halfWidth=a._halfWidth;this._halfDepth=this._halfHeight=a._halfHeight;this._min.fromArray(a._min);this._max.fromArray(a._max);for(var b=0,c=a.cells.length;b<c;b++)this.cells.push((new va).fromJSON(a.cells[b]));return this};wa.prototype.resolveReferences=function(a){for(var b=0,c=this.cells.length;b<c;b++)this.cells[b].resolveReferences(a);return this};var Bb=function(a){this.entity=void 0===a?null:a;this.timeLastSensed=this.timeBecameVisible=-Infinity;this.lastSensedPosition=new f;this.visible=
!1};Bb.prototype.toJSON=function(){return{type:this.constructor.name,entity:this.entity.uuid,timeBecameVisible:this.timeBecameVisible.toString(),timeLastSensed:this.timeLastSensed.toString(),lastSensedPosition:this.lastSensedPosition.toArray([]),visible:this.visible}};Bb.prototype.fromJSON=function(a){this.entity=a.entity;this.timeBecameVisible=parseFloat(a.timeBecameVisible);this.timeLastSensed=parseFloat(a.timeLastSensed);this.lastSensedPosition.fromArray(a.lastSensedPosition);this.visible=a.visible;
return this};Bb.prototype.resolveReferences=function(a){this.entity=a.get(this.entity)||null;return this};var Ca=function(a){this.owner=void 0===a?null:a;this.records=[];this.recordsMap=new Map;this.memorySpan=1};Ca.prototype.getRecord=function(a){return this.recordsMap.get(a)};Ca.prototype.createRecord=function(a){var b=new Bb(a);this.records.push(b);this.recordsMap.set(a,b);return this};Ca.prototype.deleteRecord=function(a){var b=this.getRecord(a);b=this.records.indexOf(b);this.records.splice(b,
1);this.recordsMap.delete(a);return this};Ca.prototype.hasRecord=function(a){return this.recordsMap.has(a)};Ca.prototype.clear=function(){this.records.length=0;this.recordsMap.clear();return this};Ca.prototype.getValidMemoryRecords=function(a,b){for(var c=this.records,e=b.length=0,d=c.length;e<d;e++){var f=c[e];a-f.timeLastSensed<=this.memorySpan&&b.push(f)}return b};Ca.prototype.toJSON=function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,records:[],memorySpan:this.memorySpan},b=
this.records,c=0,e=b.length;c<e;c++)a.records.push(b[c].toJSON());return a};Ca.prototype.fromJSON=function(a){this.owner=a.owner;this.memorySpan=a.memorySpan;a=a.records;for(var b=0,c=a.length;b<c;b++){var e=a[b];e=(new Bb).fromJSON(e);this.records.push(e)}return this};Ca.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=this.records,c=0,e=b.length;c<e;c++){var d=b[c];d.resolveReferences(a);this.recordsMap.set(d.entity,d)}return this};var zc=new f,re=new f,md=new K,
se=new f,Ac=new f,eb=function(a){this.owner=void 0===a?null:a;this.fieldOfView=Math.PI;this.range=Infinity;this.obstacles=[]};eb.prototype.addObstacle=function(a){this.obstacles.push(a);return this};eb.prototype.removeObstacle=function(a){a=this.obstacles.indexOf(a);this.obstacles.splice(a,1);return this};eb.prototype.visible=function(a){var b=this.owner,c=this.obstacles;b.getWorldPosition(Ac);zc.subVectors(a,Ac);a=zc.length();if(a>this.range)return!1;b.getWorldDirection(re);if(re.angleTo(zc)>.5*
this.fieldOfView)return!1;md.origin.copy(Ac);md.direction.copy(zc).divideScalar(a||1);b=0;for(var e=c.length;b<e;b++)if(null!==c[b].lineOfSightTest(md,se)&&se.squaredDistanceTo(Ac)<=a*a)return!1;return!0};eb.prototype.toJSON=function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,fieldOfView:this.fieldOfView,range:this.range.toString(),obstacles:[]},b=0,c=this.obstacles.length;b<c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};eb.prototype.fromJSON=function(a){this.owner=a.owner;
this.fieldOfView=a.fieldOfView;this.range=parseFloat(a.range);for(var b=0,c=a.obstacles.length;b<c;b++)this.obstacles.push(a.obstacles[b]);return this};eb.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=this.obstacles,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c]);return this};var te=new f,nd=new f,od=new f,pd=new la,ue=new f,Wb=function(a,b,c){a=void 0===a?new za:a;b=void 0===b?.1:b;c=void 0===c?1:c;var e=p.call(this)||this;e.path=a;e.radius=b;e.predictionFactor=c;e._seek=
new ya;return e};$jscomp.inherits(Wb,p);Wb.prototype.calculate=function(a,b){var c=this.path;te.copy(a.velocity).multiplyScalar(this.predictionFactor);nd.addVectors(a.position,te);var e=Infinity,d=c._waypoints.length;d=!0===c.loop?d:d-1;for(var f=0;f<d;f++){pd.from=c._waypoints[f];pd.to=!0===c.loop&&f===d-1?c._waypoints[0]:c._waypoints[f+1];pd.closestPointToPoint(nd,!0,od);var g=nd.squaredDistanceTo(od);g<e&&(e=g,ue.copy(od))}e>this.radius*this.radius&&1<c._waypoints.length&&(this._seek.target=ue,
this._seek.calculate(a,b));return b};Wb.prototype.toJSON=function(){var a=p.prototype.toJSON.call(this);a.path=this.path.toJSON();a.radius=this.radius;a.predictionFactor=this.predictionFactor;return a};Wb.prototype.fromJSON=function(a){p.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.radius=a.radius;this.predictionFactor=a.predictionFactor;return this};var T=function(a){var b=f.call(this)||this;b.vertex=a;return b};$jscomp.inherits(T,f);T.prototype.initSpinning=function(a,b,c,e,d){this.spinningOnRight=
b;this.splitNormal=new f;return this};T.prototype.initFinal=function(a){this.final=!0;return this};var fb=-1,ve=!1,O=function(a,b){if(a.polygon!==b.polygon)throw Error("Invalid portals -- dont belong to same polygon!");this.fromPortal=a;this.nextPortal=b;var c=this.fromPortal.polygon,e=b.next!==a&&b.prev!==a;e&&(this.diagonal=new f(-(b.prev.vertex.z-a.prev.vertex.z)*fb,0,(b.prev.vertex.x-a.prev.vertex.x)*fb),0===this.diagonal.squaredLength()&&(console.log(this),console.error("Diagonal zero length detected")),
this.diagonal.normalize(),this.diagonal.offset=this.diagonal.x*a.prev.vertex.x+this.diagonal.z*a.prev.vertex.z);if(c.edge.next.next.next.next!==c.edge||!e){b.next!==a&&(this.leftEdgeDirs=[new f],this.leftEdgeFlows=[O.calculateDirForFanEdge(a.prev.vertex,b.vertex,this.leftEdgeDirs[0],!1)]);b.prev!==a&&(this.rightEdgeDirs=[new f],this.rightEdgeFlows=[O.calculateDirForFanEdge(a.vertex,b.prev.vertex,this.rightEdgeDirs[0],!0)]);var d=c.edge,g=0,k=0;do{k++;if(d.vertex!==a.vertex&&d.vertex!==a.prev.vertex&&
d.vertex!==b.vertex&&d.vertex!==b.prev.vertex){var l=this.leftEdgeDirs?this.leftEdgeDirs[0]:null;var m=!1;l&&l.x*d.vertex.x+l.z*d.vertex.z>l.offset&&(l=new f,m=O.calculateDirForFanEdge(d.vertex,b.vertex,l,!1),this.leftEdgeDirs.push(l),this.leftEdgeFlows.push(m),g++,m=!0);(l=this.rightEdgeDirs?this.rightEdgeDirs[0]:null)&&l.x*d.vertex.x+l.z*d.vertex.z>l.offset&&(l=new f,m=O.calculateDirForFanEdge(d.vertex,b.prev.vertex,l,!0),this.rightEdgeDirs.push(l),this.rightEdgeFlows.push(m),g++,m=!0);m||console.warn("Failed to resolve vertex side...:"+
(this.leftEdgeDirs?" 1 ":"")+", "+(this.rightEdgeDirs?" 2 ":""))}d=d.next}while(d!==c.edge);g!==k-(e?4:3)&&(console.warn("Debug count assertion mismatch!!: "+g+" / "+k),console.log(this),d.polygon.gotErrorTriangulation=this,this.debugInfo={leftEdgeDirs:this.leftEdgeDirs,rightEdgeDirs:this.rightEdgeDirs,leftEdgeFlows:this.leftEdgeFlows,rightEdgeFlows:this.rightEdgeFlows});d.polygon.debugTriangulation=this;this.leftEdgeDirs&&1===this.leftEdgeDirs.length&&(this.leftEdgeFlows=this.leftEdgeDirs=null);
this.rightEdgeDirs&&1===this.rightEdgeDirs.length&&(this.rightEdgeFlows=this.rightEdgeDirs=null)}};O.setRightHanded=function(a){fb=a?1:-1};O.setDiscontinuous=function(a){ve=void 0===a?!0:a};O.updateTriRegion=function(a,b,c){a=c.has(a.edge)?a.edge:c.has(a.edge.prev)?a.edge.prev:a.edge.next;b.a=c.get(a.next.vertex);a=c.get(a);b.b=a[1];b.c=a[0];b.prevEdge&&!O.checkPrevFlowVertices(b,b.prevEdge)&&(b.prevEdge=null);b.lastSavedEdge&&b.lastSavedEdge!==b.prevEdge&&!O.checkPrevFlowVertices(b,b.lastSavedEdge)&&
(b.lastSavedEdge=null)};O.updateNgonFinalTri=function(a,b,c,e,d){var h=a.edge,f=null,g=fb;do{var k=-h.prev.vertex.x+d.x;var m=h.prev.vertex.z-d.z;k*=g;if(0>k*b.z+m*b.x)h=h.next;else if(k=-h.vertex.x+d.x,m=h.vertex.z-d.z,k*=g,0<k*b.z+m*b.x)h=h.next;else{f=h;break}}while(h!==a.edge);if(null===f)throw console.log(a),Error("Failed to find final destination center fan triangle");c.a=e.get(d);c.b=e.get(f.prev.vertex);c.c=e.get(f.vertex);c.prevEdge&&!O.checkPrevFlowVertices(c,c.prevEdge)&&(c.prevEdge=null);
c.lastSavedEdge&&c.lastSavedEdge!==c.prevEdge&&!O.checkPrevFlowVertices(c,c.lastSavedEdge)&&(c.lastSavedEdge=null)};O.checkPrevFlowVertices=function(a,b){if(ve)return!1;var c=!1;b[0]&&a.a.vertex===b[0].vertex?(a.a=b[0],c=!0):b[1]&&a.a.vertex===b[1].vertex&&(a.a=b[1],c=!0);b[0]&&a.b.vertex===b[0].vertex?(a.b=b[0],c=!0):b[1]&&a.b.vertex===b[1].vertex&&(a.b=b[1],c=!0);b[0]&&a.c.vertex===b[0].vertex?(a.c=b[0],c=!0):b[1]&&a.c.vertex===b[1].vertex&&(a.c=b[1],c=!0);return c};O.prototype.updateFlowTriLaned=
function(a,b,c){if(0===b.lane)if(this.diagonal){var e=this.diagonal;var d=c.get(this.fromPortal)[0];e.x*a.x+e.z*a.z>=e.offset?(a=c.get(this.nextPortal)[1],c=c.get(this.nextPortal)[0]):(a=c.get(this.fromPortal)[1],c=c.get(this.nextPortal)[1])}else d=c.get(this.fromPortal)[0],a=c.get(this.fromPortal)[1],c=c.get(this.nextPortal)[this.nextPortal.vertex!==d.vertex&&this.nextPortal.vertex!==a.vertex?0:1];else{var f=(d=0>b.lane)?this.leftEdgeFlows:this.rightEdgeFlows;e=d?-b.lane-1:b.lane-1;c=d?1:0;a=f[e][c];
e++;c=f[e][c];e=f[e][d?0:1];d?(d=a,a=e):(d=a,a=c,c=e)}if(!d||!a||!c)throw Error("Should have abc vertices! "+b.lane+" / "+(f?f.length:"")+" ::"+d+","+a+","+c+"["+(leftwards?"<":">")+"]");b.a=d;b.b=a;b.c=c;b.prevEdge&&!O.checkPrevFlowVertices(b,b.prevEdge)&&(b.prevEdge=null);b.lastSavedEdge&&b.lastSavedEdge!==b.prevEdge&&!O.checkPrevFlowVertices(b,b.lastSavedEdge)&&(b.lastSavedEdge=null)};O.prototype.updateLane=function(a,b){var c,e;if((c=this.leftEdgeDirs?this.leftEdgeDirs[0]:!1)&&c.x*a.x+c.z*a.z>
c.offset){var d=-1;var f=this.leftEdgeDirs.length-1;for(e=1;e<f;e++){c=this.leftEdgeDirs[e];if(c.offset>=c.x*a.x+c.z*a.z)break;d--}d<b.lane?(b.lastSavedEdge=null,b.prevEdge=null):d>b.lane&&(a=d-1,b.prevEdge=-a<this.leftEdgeDirs.length-1?this.leftEdgeDirs[-a]:null,b.lastSavedEdge||(b.lastSavedEdge=b.prevEdge),null===b.prevEdge&&(b.lastSavedEdge=null,console.warn("Out of bounds detected for position..left")))}else if((c=this.rightEdgeDirs?this.rightEdgeDirs[0]:!1)&&c.x*a.x+c.z*a.z>c.offset){d=1;f=this.rightEdgeDirs.length-
1;for(e=1;e<f;e++){c=this.rightEdgeDirs[e];if(c.offset>=c.x*a.x+c.z*a.z)break;d++}d>b.lane?(b.lastSavedEdge=null,b.prevEdge=null):d<b.lane&&(a=d+1,b.prevEdge=a<this.rightEdgeDirs.length-1?this.rightEdgeDirs[a]:null,b.lastSavedEdge||(b.lastSavedEdge=b.prevEdge),null===b.prevEdge&&(b.lastSavedEdge=null,console.warn("Out of bounds detected for position..right")))}else d=0;0!=d&&console.log("Lane != 0 case detected:"+d+" / "+(0>d?this.leftEdgeDirs:this.rightEdgeDirs).length);b.lane=d};O.calculateDirForFanEdge=
function(a,b,c,e){var d=b.x-a.x;b=b.z-a.z;var f=new T(a);f.x=d;f.z=b;f.normalize();var g=e?-fb:fb;c.x=-b*g;c.z=d*g;c.normalize();c.offset=c.x*a.x+c.z*a.z;return e?[f,null]:[null,f]};var v=new f,A=new f,L=new f,X=function(a){this.navMesh=a;this._flowedFinal=!1};X.cacheRegionIndexLookup=function(a){if(!a.regionIndexMap){a.regionIndexMap=new Map;for(var b=a.regions.length,c=0;c<b;c++)a.regionIndexMap.set(a.regions[c],c);a.getNodeIndex=X.getCachedNodeIndexForRegionProto}};X.getCachedNodeIndexForRegionProto=
function(a){return this.regionIndexMap.has(a)?this.regionIndexMap.get(a):-1};X.prototype.initPersistant=function(a){this.edgeFieldMap=new Map;this.triangulationMap=new Map;this.savedRegionFlows=new Map;this.pathRef=a};X.prototype.resetPersistant=function(a){this.edgeFieldMap.clear();this.triangulationMap.clear();this.savedRegionFlows.clear();this.pathRef=a};X.prototype.initTransitional=function(a,b,c){this.edgeFieldMap=new Map;this.pathRef=this.savedRegionFlows=this.triangulationMap=null;this.calcRegionFlow(a,
b,c);return""};X.prototype.hasFlowFromRegion=function(a,b){b||(b=this.pathRef);return Array.isArray(b)?0<=b.indexOf(this.navMesh.getNodeIndex(a)):b._cost.has(this.navMesh.getNodeIndex(a))};X.prototype.getFlowEdges=function(a,b,c){var e=[],d,f=null;this._flowedFinal=!1;if(Array.isArray(b)){var g=b.indexOf(a);if(0>g)return null;if(g>=b.length-1)return this._flowedFinal=!0,e;var l=b[++g];f=this.navMesh.regions[a].getEdgeTo(this.navMesh.regions[l]);e.push(f);for(d=l;null!==d;){l=b[++g];if(!l)break;d=
this.navMesh.regions[d].getEdgeTo(this.navMesh.regions[l]);e.push(d);d=d.vertex===f.vertex||d.prev.vertex===f.prev.vertex?l:null;c&&(d=l)}this._flowedFinal=g>=b.length-1}else{g=b._cost;if(!g.has(a))return null;var k=Infinity;d=a;if(a===b.source)return this._flowedFinal=!0,e;for(;null!==d;){a=this.navMesh.graph._edges.get(d);var m=a.length;l=null;for(var p=0;p<m;p++){var q=a[p].to;if(q===b.source){l=q;break}g.has(q)&&g.get(q)<k&&(k=g.get(q),l=q)}if(null!==l){if(d=this.navMesh.regions[d].getEdgeTo(this.navMesh.regions[l]),
null!==f?(e.push(d),d=d.vertex===f.vertex||d.prev.vertex===f.prev.vertex?l:null,c&&(d=l)):(f=d,e.push(d),d=l),l===b.source){this._flowedFinal=!0;break}}else d=null}}return e};X.prototype.collinear=function(a,b){var c=a.prev.vertex.z,e=a.vertex.z;b=a.prev===b?b.prev.vertex:b.vertex;var d=b.z;(a=0===a.prev.vertex.x*(e-d)+a.vertex.x*(d-c)+b.x*(c-e))&&console.log("Collinear detected");return a};X.prototype.setupTriangulation=function(a,b,c){if(!a){var e=0,d=b.polygon.edge;do{if(d!==b&&!this.collinear(b,
d)){var f=d.squaredLength();f>=e&&(e=f,a=d)}d=d.next}while(d!==b.polygon.edge)}this.triangulationMap?(d=this.triangulationMap,c||(c=a),e=d.get(c),e||(e=new O(a,b),d.set(c,e))):(this.localTriangulation||(this.localTriangulation=new O(a,b)),e=this.localTriangulation);return e};X.prototype._calcTriRegionField=function(a,b,c){var e=this.edgeFieldMap;a=a.edge;var d=b[0];a!==d&&(a=a.next,a!==d&&(a=a.next));d=a.next.vertex;v.x=d.x;v.z=d.z;A.x=.5*(a.vertex.x+a.prev.vertex.x);A.z=.5*(a.vertex.z+a.prev.vertex.z);
e.set(d,(new T(d)).subVectors(A,v).normalize());this._calcDestPortalField(b,d,null,c)};X.prototype._calcDestPortalField=function(a,b,c,e){var d=this.edgeFieldMap,f=fb;var g=0;var l=b;var k=a[0];v.x=k.vertex.x-l.x;v.z=k.vertex.z-l.z;L.x=v.z*f;L.z=-v.x*f;for(tryEdge=a[++g];tryEdge&&k.vertex===tryEdge.vertex;)tryEdge=a[++g];if(tryEdge){A.x=tryEdge.vertex.x-k.vertex.x;A.z=tryEdge.vertex.z-k.vertex.z;var m=(new T(k.vertex)).copy(0<=A.x*L.x+A.z*L.z?A:v).normalize()}else tryEdge?m=(new T(k.vertex)).copy(v).normalize():
(A.x=e.x-k.vertex.x,A.z=e.z-k.vertex.z,m=(new T(k.vertex)).copy(0<=A.x*L.x+A.z*L.z?A:v).normalize().initFinal(e));for(l=1;l<g;l++)if(tryEdge=a[l],v.x=tryEdge.prev.vertex.x-tryEdge.vertex.x,v.z=tryEdge.prev.vertex.z-tryEdge.vertex.z,L.x=-v.z*f,L.z=v.x*f,0>m.x*L.x+m.z*L.z){m.initSpinning(tryEdge,!1,a[l+1],e);break}g===a.length-1&&(tryEdge=a[g],tryEdge.next.next.next!==tryEdge&&tryEdge.prev.vertex!==k.vertex&&(v.x=tryEdge.prev.vertex.x-k.vertex.x,v.z=tryEdge.prev.vertex.z-k.vertex.z,L.x=-v.z*f,L.z=v.x*
f,0>m.x*L.x+m.z*L.z&&m.initSpinning(tryEdge,!1,null,e,!0)));g=0;k=a[0];l=c?c:b;v.x=k.prev.vertex.x-l.x;v.z=k.prev.vertex.z-l.z;L.x=-v.z*f;L.z=v.x*f;for(tryEdge=a[++g];tryEdge&&k.prev.vertex===tryEdge.prev.vertex;)tryEdge=a[++g];tryEdge?(A.x=tryEdge.prev.vertex.x-k.prev.vertex.x,A.z=tryEdge.prev.vertex.z-k.prev.vertex.z,b=(new T(k.prev.vertex)).copy(0<=A.x*L.x+A.z*L.z?A:v).normalize()):tryEdge?b=(new T(k.prev.vertex)).copy(v).normalize():(A.x=e.x-k.prev.vertex.x,A.z=e.z-k.prev.vertex.z,b=(new T(k.prev.vertex)).copy(0<=
A.x*L.x+A.z*L.z?A:v).normalize().initFinal(e));for(l=1;l<g;l++)if(tryEdge=a[l],v.x=tryEdge.prev.vertex.x-tryEdge.vertex.x,v.z=tryEdge.prev.vertex.z-tryEdge.vertex.z,L.x=-v.z*f,L.z=v.x*f,0>b.x*L.x+b.z*L.z){b.initSpinning(tryEdge,!0,a[l+1],e);break}a=[m,b];d.set(k,a);return a};X.prototype._calcNonTriRegionField=function(a,b,c){var e=this.edgeFieldMap,d=a.fromPortal,f=a.nextPortal;if(f!==b[0])throw Error("Assertion failed: nextPortal of triangulation should match edgeFlows[0] assumption!");var g=null,
l=null;d.prev.vertex!==f.vertex&&(v.x=d.prev.vertex.x,v.z=d.prev.vertex.z,A.x=f.vertex.x,A.z=f.vertex.z,g=(new T(d.prev.vertex)).subVectors(A,v).normalize());d.vertex!==f.prev.vertex&&(v.x=d.vertex.x,v.z=d.vertex.z,A.x=f.prev.vertex.x,A.z=f.prev.vertex.z,l=(new T(d.vertex)).subVectors(A,v).normalize());e.set(d,d=[g,l]);g=this._calcDestPortalField(b,g?g.vertex:l.vertex,g&&l?l.vertex:null,c);d[0]||(d[0]=g[0]);d[1]||(d[1]=g[1]);l=g;if(!d[0]||!d[1])throw Error("Could not resolve fromPortalVectors:"+d);
e=e.get(a.nextPortal);if(e!==g)throw Error("Should match!");if(!e[0]||!e[1])throw Error("Should have all vectors!");if(a.leftEdgeFlows){f=a.leftEdgeFlows;d=f.length;for(e=1;e<d;e++)if(g=this._calcDestPortalField(b,f[e][1].vertex,null,c),f[e][0]=g[0],!f[e][0]||!f[e][1])throw Error("Did not fill up fan edge flows...left");f[0][0]=l[0];if(!f[0][0]||!f[0][1])throw Error("Did not fill up fan edge flows...left000");}if(a.rightEdgeFlows){f=a.rightEdgeFlows;d=f.length;for(e=1;e<d;e++)if(g=this._calcDestPortalField(b,
f[e][0].vertex,null,c),f[e][1]=g[1],!f[e][0]||!f[e][1])throw Error("Did not fill up fan edge flows...right");f[0][1]=l[1];if(!f[0][0]||!f[0][1])throw Error("Did not fill up fan edge flows...right000");}};X.calcFinalRegionField=function(a,b,c){if(!c.has(a.edge.vertex)){edge=a.edge;do c.set(edge.vertex,new T(edge.vertex)),edge=edge.next;while(edge!==a.edge)}c.has(b)||c.set(b,new T(b));edge=a.edge;do flowVertex=c.get(edge.vertex),v.x=edge.vertex.x,v.z=edge.vertex.z,A.x=b.x,A.z=b.z,flowVertex.subVectors(A,
v).initFinal(b),flowVertex.normalize(),edge=edge.next;while(edge!==a.edge)};X.prototype.getFromNodeIndex=function(a,b,c){var e=this.navMesh.getNodeIndex(a);b=this.navMesh.getNodeIndex(b);c||(c=this.pathRef);if(Array.isArray(c))return b=c.indexOf(b),0>=b?-1:c[b-1];c=c._cost;a=Infinity;for(var d=e,f=null;null!==d;){var g=this.navMesh.graph._edges.get(d),l=g.length;e=null;for(var k=0;k<l;k++){var m=g[k].to;if(m===b)return d;c.has(m)&&c.get(m)<a&&(a=c.get(m),e=m)}if(null!==e)d=this.navMesh.regions[d].getEdgeTo(this.navMesh.regions[e]),
null!==f?d=d.vertex===f.vertex||d.prev.vertex===f.prev.vertex?e:null:(f=d,d=e);else break}return-1};X.prototype.calcRegionFlow=function(a,b,c,e){if(!c&&(c=this.pathRef,!c))throw Error("calcRegionFlow:: unable to retrieve pathRef!");var d=a+","+b;if(this.savedRegionFlows&&this.savedRegionFlows.has(d))return this.savedRegionFlows.get(d);var f=this.navMesh.regions[b],g=this.edgeFieldMap;edgeFlows=this.getFlowEdges(b,c);this.savedRegionFlows&&this.savedRegionFlows.set(d,edgeFlows);if(null===edgeFlows)return null;
if(0===edgeFlows.length)return X.calcFinalRegionField(f,e,g),edgeFlows;b=edgeFlows[0];g.has(b)||g.set(b,[new T(b.vertex),new T(b.prev.vertex)]);(a=f.edge.next.next.next===f.edge?null:0<=a?this.navMesh.regions[a].getEdgeTo(f).twin:null)&&(g.has(a)||g.set(a,[new T(a.vertex),new T(a.prev.vertex)]));this._flowedFinal||(e=null);f.edge.next.next.next!==f.edge?(f=this.setupTriangulation(null,b,b),this._calcNonTriRegionField(f,edgeFlows,e),this.lastTriangulation=f):this._calcTriRegionField(f,edgeFlows,e);
return edgeFlows};var qd=new f,sa=function(){};sa.prototype.calcDir=function(a,b){var c=this.a.vertex,e=this.b.vertex,d=this.c.vertex,f=0,g=0;var l=this.c;var k=(a.x-c.x)*(e.z-c.z)-(e.x-c.x)*(a.z-c.z);var m=0+k;if(l.spinning||l.splitNormal&&l.splitNormal.x*a.x+l.splitNormal.z*a.z>l.splitNormal.offset)l=qd,l.x=a.x-d.x,l.z=a.z-d.z,l.normalize();f+=k*l.x;g+=k*l.z;l=this.a;k=(a.x-e.x)*(d.z-e.z)-(d.x-e.x)*(a.z-e.z);m+=k;if(l.spinning||l.splitNormal&&l.splitNormal.x*a.x+l.splitNormal.z*a.z>l.splitNormal.offset)l=
qd,l.x=a.x-c.x,l.z=a.z-c.z,l.normalize();f+=k*l.x;g+=k*l.z;l=this.b;k=(a.x-d.x)*(c.z-d.z)-(c.x-d.x)*(a.z-d.z);m+=k;if(l.spinning||l.splitNormal&&l.splitNormal.x*a.x+l.splitNormal.z*a.z>l.splitNormal.offset)l=qd,l.x=a.x-e.x,l.z=a.z-e.z,l.normalize();f+=k*l.x;g+=k*l.z;b.x=f/m;b.z=g/m};sa.prototype.reset=function(a){this.lane=this.lastSavedEdge=this.prevEdge=null;a&&(this.curRegion=null)};sa.prototype.withinFlowPlane=function(a,b){b=void 0===b?.001:b;return Math.abs((this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:
this.curRegion).distanceToPoint(a))<=b};sa.pointWithinTriangleBounds=function(a,b,c,e){var d=a.x;a=a.z;return 0<=(e.x-d)*(b.z-a)-(b.x-d)*(e.z-a)&&0<=(b.x-d)*(c.z-a)-(c.x-d)*(b.z-a)&&0<=(c.x-d)*(e.z-a)-(e.x-d)*(c.z-a)};sa.prototype.currentTriArea=function(){var a=this.a.vertex,b=this.b.vertex,c=this.c.vertex;return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};sa.prototype.withinCurrentTriangleBounds=function(a){var b=a.x;a=a.z;var c=this.a.vertex,d=this.b.vertex,f=this.c.vertex;return 0<=(f.x-b)*(c.z-a)-
(c.x-b)*(f.z-a)&&0<=(c.x-b)*(d.z-a)-(d.x-b)*(c.z-a)&&0<=(d.x-b)*(f.z-a)-(f.x-b)*(d.z-a)};sa.prototype.getCurRegion=function(){return this.curRegion&&this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:this.curRegion};sa.pointWithinRegion=function(a,b){var c=b.edge;do{var d=c.tail(),f=c.head();if(0>(a.x-d.x)*(f.z-d.z)-(f.x-d.x)*(a.z-d.z))return!1;c=c.next}while(c!==b.edge)};sa.prototype.withinCurrentRegionBounds=function(a){var b=this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:
this.curRegion,c=b.edge;do{var d=c.tail(),f=c.head();if(0>(a.x-d.x)*(f.z-d.z)-(f.x-d.x)*(a.z-d.z))return!1;c=c.next}while(c!==b.edge)};var P=new f,ud=new f,Cc=new f,Bc=new la,Cb=function(a,b,c,d,f,g){d=void 0===d?.001:d;f=void 0===f?0:f;g=void 0===g?null:g;var e=p.call(this)||this;e.flowField=a;e.finalDestPt=b;e.epsilon=d;e.pathRef=c;e.arrivalSqDist=0===f?e.epsilon:f;e.arrivalSqDist*=e.arrivalSqDist;e.arrivalCallback=g;return e};$jscomp.inherits(Cb,p);Cb.prototype.onAdded=function(a){a.agent=new sa};
Cb.prototype.onRemoved=function(a){a.agent=null};Cb.prototype.calculate=function(a,b){var c=a.agent;P.x=0;P.z=0;var d=a.position;if(!1===c.lane||!0===c.lane)return a.position.squaredDistanceTo(this.finalDestPt)<this.arrivalSqDist?!1===c.lane&&(null!==this.arrivalCallback&&this.arrivalCallback(a),c.lane=!0):c.calcDir(d,P),P.x*=a.maxSpeed,P.z*=a.maxSpeed,b.x=P.x-a.velocity.x,b.z=P.z-a.velocity.z,b;if(c.curRegion){if(null===c.lane){var f=c.getCurRegion();if(this.flowField.hasFlowFromRegion(f))this.setCurRegion(a,
f);else return b.x=-a.velocity.x,b.z=-a.velocity.z,b}if(!c.withinCurrentTriangleBounds(d))if(f=c.getCurRegion(),f.edge.next.next.next!==f.edge&&c.withinCurrentRegionBounds(a.position)&&c.withinFlowPlane(a.position,this.epsilon))c.curRegion.updateLane(d,c),c.curRegion.updateFlowTriLaned(d,c,this.flowField.edgeFieldMap);else{var g=c.curRegion;if(!1===this.setCurRegion(a))return c.lane=!1,c.calcDir(d,P),P.x*=a.maxSpeed,P.z*=a.maxSpeed,b.x=P.x-a.velocity.x,b.z=P.z-a.velocity.z,b;c.curRegion||(d=sd(f,
d),c.curRegion=g,f.edge.next.next.next!==f.edge&&g!==f&&(g.updateLane(d,c),g.updateFlowTriLaned(d,c,this.flowField.edgeFieldMap)))}}else if(this.setCurRegion(a),!c.curRegion)return b.x=-a.velocity.x,b.z=-a.velocity.z,b;c.calcDir(d,P);P.x*=a.maxSpeed;P.z*=a.maxSpeed;b.x=P.x-a.velocity.x;b.z=P.z-a.velocity.z;return b};Cb.prototype.setCurRegion=function(a,b){var c=a.agent,d=this.flowField,f=b?null:c.getCurRegion(),g=b?b:d.navMesh.getRegionForPoint(a.position,this.epsilon);if(!g)return c.curRegion=null;
a=a.position;void 0===b||sa.pointWithinRegion(a,g)||(a=sd(g,a));if(g===f)return c.curRegion!==g&&(c.curRegion.updateLane(a,c),c.curRegion.updateFlowTriLaned(a,c,d.edgeFieldMap)),!0;b=f?d.getFromNodeIndex(f,g,this.pathRef):-1;b=d.calcRegionFlow(b,d.navMesh.getNodeIndex(g),this.pathRef,this.finalDestPt);if(!b)return c.curRegion=null,console.log("setCurRegion:: Could not find flow path from current position"),0;if(g.edge.next.next.next===g.edge){c.curRegion=g;if(0===b.length)return O.updateNgonFinalTri(g,
a,c,d.edgeFieldMap,this.finalDestPt,this.epsilon),!1;c.lane=0;O.updateTriRegion(c.curRegion,c,d.edgeFieldMap)}else{if(0===b.length)return c.curRegion=g,O.updateNgonFinalTri(g,a,c,d.edgeFieldMap,this.finalDestPt,this.epsilon),!1;c.curRegion=d.triangulationMap.get(b[0]);c.curRegion||(c.curRegion=d.setupTriangulation(null,b[0],b[0]));c.curRegion.updateLane(a,c);c.curRegion.updateFlowTriLaned(a,c,d.edgeFieldMap)}return 1};var we=function(){};we.prototype.execute=function(){};var rd=function(){this.tasks=
[];this.options={timeout:1E3};this._active=!1;this._handler=td.bind(this);this._taskHandle=0};rd.prototype.enqueue=function(a){this.tasks.push(a);return this};rd.prototype.update=function(){0<this.tasks.length?!1===this._active&&(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):this._active=!1;return this};d.AABB=E;d.AStar=xb;d.AlignmentBehavior=cc;d.ArriveBehavior=Da;d.BFS=Pb;d.BVH=cd;d.BVHNode=ka;d.BoundingSphere=R;d.CHFace=qa;d.CHVertex=ie;d.CHVertexList=pa;d.Cell=
va;d.CellSpacePartitioning=wa;d.CohesionBehavior=ec;d.CompositeGoal=ba;d.ConvexHull=Q;d.Corridor=xc;d.CostTable=Qa;d.DFS=Qb;d.Dijkstra=Rb;d.Edge=Aa;d.EntityManager=ca;d.EvadeBehavior=Ta;d.EventDispatcher=Lb;d.FleeBehavior=Sa;d.FlowAgent=sa;d.FlowVertex=T;d.FollowPathBehavior=hb;d.FuzzyAND=pc;d.FuzzyCompositeTerm=aa;d.FuzzyFAIRLY=ob;d.FuzzyModule=ha;d.FuzzyOR=qc;d.FuzzyRule=vb;d.FuzzySet=x;d.FuzzyTerm=Ga;d.FuzzyVERY=pb;d.FuzzyVariable=Ha;d.GameEntity=G;d.Goal=B;d.GoalEvaluator=Ob;d.Graph=W;d.GraphUtils=
ne;d.HalfEdge=Oa;d.HeuristicPolicyDijkstra=ae;d.HeuristicPolicyEuclid=bd;d.HeuristicPolicyEuclidSquared=Zd;d.HeuristicPolicyManhattan=$d;d.InterposeBehavior=Ua;d.LeftSCurveFuzzySet=Mb;d.LeftShoulderFuzzySet=qb;d.LineSegment=la;d.Logger=y;d.MathUtils=M;d.Matrix3=C;d.Matrix4=D;d.MemoryRecord=Bb;d.MemorySystem=Ca;d.MeshGeometry=$a;d.MessageDispatcher=ta;d.MovingEntity=ia;d.NavEdge=vc;d.NavMesh=da;d.NavMeshFlowField=X;d.NavMeshFlowFieldBehavior=Cb;d.NavMeshLoader=oe;d.NavNode=wc;d.Node=wb;d.NormalDistFuzzySet=
rb;d.OBB=Z;d.ObstacleAvoidanceBehavior=Va;d.OffsetPursuitBehavior=Wa;d.OnPathBehavior=Wb;d.Path=za;d.Plane=ea;d.Polygon=V;d.Polyhedron=Pa;d.PriorityQueue=La;d.PursuitBehavior=Xa;d.Quaternion=w;d.Ray=K;d.RectangularTriggerRegion=Ja;d.Regulator=Yd;d.RightSCurveFuzzySet=Nb;d.RightShoulderFuzzySet=sb;d.SAT=Na;d.SeekBehavior=ya;d.SeparationBehavior=lc;d.SingletonFuzzySet=tb;d.Smoother=Jb;d.SphericalTriggerRegion=Za;d.State=Fa;d.StateMachine=fa;d.SteeringBehavior=p;d.SteeringManager=ja;d.Task=we;d.TaskQueue=
rd;d.Telegram=Ra;d.Think=ua;d.Time=nb;d.TriangularFuzzySet=ub;d.Trigger=Ka;d.TriggerRegion=oa;d.Vector3=f;d.Vehicle=Ya;d.Vision=eb;d.WanderBehavior=jb;d.WorldUp=Ec;Object.defineProperty(d,"__esModule",{value:!0})});
